!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f125c0d8-8971-4143-a6ae-c6f0128cc9ba",e._sentryDebugIdIdentifier="sentry-dbid-f125c0d8-8971-4143-a6ae-c6f0128cc9ba")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6377],{58288:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return n(15824)}])},72174:function(e,t,n){"use strict";n.d(t,{Q:function(){return M},G:function(){return z}});var s=n(97458),a=n(52983),r=n(89112),l=n(52176),i=n(39635),o=n(21935),d=n(85143),c=n(78509),u=n(99794),m=n(98809);let h=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"ServiceRoleIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},x=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AnonIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},f=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AuthenticatedIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===n?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})};var p=n(91837),g=n(33816),y=function(e){let{label:t,value:n,isSelected:a,onSelectedChange:r,icon:l}=e;return(0,s.jsxs)("label",{className:(0,i.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",a&&"border-foreground-muted hover:border-foreground-muted bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&r(n)},htmlFor:"role-".concat(n),"data-sentry-component":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationRadio.tsx",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[l&&(0,s.jsx)("div",{children:l}),a&&(0,s.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof a&&(0,s.jsx)(p.Z,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===a&&(0,s.jsx)(g.Z,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,s.jsx)("input",{id:"role-".concat(n),type:"radio",name:"role",value:n,checked:!!a,onChange:e=>{r(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,s.jsxs)("span",{className:(0,i.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",a&&"text-foreground"),children:[null!=t?t:n," role"]})]})},v=n(23382),j=n(43901),b=n(81343),w=n(94849),N=n(19215),S=n(20787),E=n(95767),_=n(23775),C=n(399),k=n(36219),R=n(86812),L=n(74313),I=n(12987),A=()=>{var e,t,n,r;let[i,d]=(0,a.useState)(""),[u,m]=(0,a.useState)("aal1"),h=(0,c.fN)(),x=(0,v.Nr)(i,300),{project:f}=(0,S.d2)(),{data:p,isSuccess:g,isLoading:y,isError:A,error:z,isFetching:M,isPreviousData:Z}=(0,_.x7)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,keywords:x.trim().toLocaleLowerCase()},{keepPreviousData:!0}),U=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.pages.flatMap(e=>e.result))&&void 0!==e?e:[]},[null==p?void 0:p.pages]),P=(null===(e=h.role)||void 0===e?void 0:e.type)==="postgrest"&&"authenticated"===h.role.role&&h.role.user;function F(e){h.setRole({type:"postgrest",role:"authenticated",user:e,aal:u})}return(0,s.jsxs)("div",{className:"flex flex-col gap-1","data-sentry-component":"UserImpersonationSelector","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsx)("h2",{className:"text-foreground text-sm",children:P?"Impersonating ".concat((0,I.Gf)(P,null!==(r=null!==(n=null!==(t=P.email)&&void 0!==t?t:P.phone)&&void 0!==n?n:P.id)&&void 0!==r?r:"Unknown")):"Impersonate a User"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:P?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),P?(0,s.jsx)(D,{user:P,onClick:function(){h.setRole(void 0)},isImpersonating:!0,aal:u}):(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,s.jsx)(C.Z,{className:"table-editor-search border-none",icon:Z&&M?(0,s.jsx)(j.Z,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,s.jsx)(b.Z,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search for a user..",onChange:e=>d(e.target.value),value:i,size:"small",actions:i&&(0,s.jsx)(l.z,{size:"tiny",type:"text",className:"px-1",onClick:()=>d(""),children:(0,s.jsx)(w.Z,{size:12,strokeWidth:2})})}),(0,s.jsxs)(k.zF,{children:[(0,s.jsx)(k.wy,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,s.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Advanced options"}),(0,s.jsx)(o.Z,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,s.jsxs)(k.Fw,{className:"mt-1 flex flex-row items-center gap-x-4 text-sm text-foreground-light",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,s.jsx)("h3",{children:"MFA assurance level"}),(0,s.jsxs)(L.b,{side:"top",className:"flex flex-col gap-1 max-w-96",children:[(0,s.jsxs)("p",{children:["AAL1 verifies users via standard login methods, while AAL2 adds a second authentication factor.",(0,s.jsx)("br",{}),"If you're not using MFA, you can leave this on AAL1."]}),(0,s.jsxs)("a",{href:"/docs/guides/auth/auth-mfa",target:"_blank",rel:"noreferrer",className:"flex items-center gap-x-1 opacity-50 hover:opacity-100 transition",children:["Learn more about MFA ",(0,s.jsx)(N.Z,{size:14,strokeWidth:2})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-row items-center gap-x-2 text-xs font-bold",children:[(0,s.jsx)("p",{className:"aal1"===u?void 0:"text-foreground-lighter",children:"AAL1"}),(0,s.jsx)(R.r,{checked:"aal2"===u,onCheckedChange:function(){m(e=>"aal2"===e?"aal1":"aal2")}}),(0,s.jsx)("p",{className:"aal2"===u?void 0:"text-foreground-lighter",children:"AAL2"})]})]})]}),y&&(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,s.jsx)(j.Z,{className:"animate-spin",size:24}),(0,s.jsx)("span",{children:"Loading users..."})]}),A&&(0,s.jsx)(E.Z,{error:z,subject:"Failed to retrieve users"}),g&&(U.length>0?(0,s.jsx)("ul",{className:"divide-y max-h-[150px] overflow-y-scroll",role:"list",children:U.map(e=>(0,s.jsx)("li",{role:"listitem",children:(0,s.jsx)(T,{user:e,onClick:F})},e.id))}):(0,s.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,s.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})}))]})]})};let D=e=>{var t,n,a;let{user:r,onClick:i,isImpersonating:o=!1,aal:c}=e,u=(0,I.E$)(r),m=(0,I.Gf)(r,null!==(a=null!==(n=null!==(t=r.email)&&void 0!==t?t:r.phone)&&void 0!==n?n:r.id)&&void 0!==a?a:"Unknown")+(r.is_anonymous?" (anonymous)":"");return(0,s.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground","data-sentry-component":"UserImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-4 pl-0.5 py-0.5 border rounded-full max-w-l",children:[u?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:u,alt:m}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,s.jsx)(d.Z,{size:12,strokeWidth:2})}),(0,s.jsxs)("span",{className:"text-sm truncate",children:[m," ",(0,s.jsx)("span",{className:"ml-2 text-foreground-lighter text-xs font-light",children:"aal2"===c?"AAL2":"AAL1"})]})]}),(0,s.jsx)(l.z,{type:"default",onClick:()=>i(r),"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:o?"Stop Impersonating":"Impersonate"})]})},T=e=>{var t,n,a;let{user:r,onClick:i,isImpersonating:o=!1}=e,c=(0,I.E$)(r),u=(0,I.Gf)(r,null!==(a=null!==(n=null!==(t=r.email)&&void 0!==t?t:r.phone)&&void 0!==n?n:r.id)&&void 0!==a?a:"Unknown")+(r.is_anonymous?" (anonymous)":"");return(0,s.jsxs)("div",{className:"flex items-center justify-between py-1 text-foreground","data-sentry-component":"UserRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[c?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:c,alt:u}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border text-muted flex items-center justify-center text-background",children:(0,s.jsx)(d.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"text-sm",children:u})]}),(0,s.jsx)(l.z,{type:"default",onClick:()=>i(r),"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:o?"Stop Impersonating":"Impersonate"})]})};var z=e=>{var t;let{serviceRoleLabel:n,padded:r=!0}=e,l=(0,c.fN)(),[o,d]=(0,a.useState)(()=>{var e;return(null===(e=l.role)||void 0===e?void 0:e.type)==="postgrest"&&("anon"===l.role.role||"authenticated"===l.role.role)?l.role.role:"service_role"}),m=!!("authenticated"===o&&(null===(t=l.role)||void 0===t?void 0:t.type)==="postgrest"&&"authenticated"===l.role.role&&l.role.user);function p(e){"service_role"===e&&l.setRole(void 0),"anon"===e&&l.setRole({type:"postgrest",role:e}),d(e)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-3",r?"p-5":"pb-5"),children:[(0,s.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,s.jsxs)("fieldset",{className:"flex gap-3",children:[(0,s.jsx)(y,{value:"service_role",isSelected:"service_role"===o,onSelectedChange:p,label:n,icon:(0,s.jsx)(h,{isSelected:"service_role"===o}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,s.jsx)(y,{value:"anon",isSelected:"anon"===o,onSelectedChange:p,icon:(0,s.jsx)(x,{isSelected:"anon"===o}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,s.jsx)(y,{value:"authenticated",isSelected:"authenticated"===o&&(m||"partially"),onSelectedChange:p,icon:(0,s.jsx)(f,{isSelected:"authenticated"===o}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"})]})}),"service_role"===o&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,s.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===o&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,s.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===o&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,s.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.VD,{}),(0,s.jsx)("div",{className:(0,i.cn)("py-5",r&&"px-5"),children:(0,s.jsx)(A,{})})]})]})},M=e=>{var t,n,d,u;let{serviceRoleLabel:m,variant:h="regular",align:x="end"}=e,f=(0,c.fN)(),[p,g]=(0,a.useState)(!1),y=null!==(u=null!==(d=null===(t=f.role)||void 0===t?void 0:t.role)&&void 0!==d?d:m)&&void 0!==u?u:"service role";return(0,s.jsxs)(r.J2,{open:p,onOpenChange:g,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"RoleImpersonationPopover","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,s.jsx)(r.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsx)(l.z,{size:"tiny",type:"default",className:(0,i.cn)("h-[26px] pr-3 gap-0","connected-on-right"===h&&"rounded-r-none border-r-0","connected-on-left"===h&&"rounded-l-none border-l-0","connected-on-both"===h&&"rounded-none border-x-0"),"data-sentry-element":"Button","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-foreground-muted",children:"role"}),(0,s.jsx)("span",{children:y}),(null===(n=f.role)||void 0===n?void 0:n.type)==="postgrest"&&"authenticated"===f.role.role&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z,{user:f.role.user}),(0,s.jsx)("span",{className:"text-xs text-foreground-lighter font-light",children:"aal2"===f.role.aal?"AAL2":"AAL1"})]}),(0,s.jsx)(o.Z,{className:"text-muted",strokeWidth:1,size:12,"data-sentry-element":"ChevronDown","data-sentry-source-file":"RoleImpersonationPopover.tsx"})]})})}),(0,s.jsx)(r.yk,{className:"p-0 w-full overflow-hidden",side:"bottom",align:x,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsx)(z,{serviceRoleLabel:m,"data-sentry-element":"RoleImpersonationSelector","data-sentry-source-file":"RoleImpersonationPopover.tsx"})})]})};let Z=e=>{var t,n,a;let{user:r}=e,l=(0,I.E$)(r),i=(0,I.Gf)(r,null!==(a=null!==(n=null!==(t=r.email)&&void 0!==t?t:r.phone)&&void 0!==n?n:r.id)&&void 0!==a?a:"Unknown");return(0,s.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"UserRoleButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[l?(0,s.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:l,alt:i}):(0,s.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,s.jsx)(d.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"truncate max-w-[84px]",children:i})]})}},18655:function(e,t,n){"use strict";var s,a;n.d(t,{EE:function(){return s},FK:function(){return l},Ki:function(){return i},ZE:function(){return r}});let r={TICK:"hsl(var(--background-overlay-hover))",AXIS:"hsl(var(--background-overlay-hover))",GREEN_1:"hsl(var(--brand-default))",GREEN_2:"hsl(var(--brand-500))"},l=e=>e.map(e=>{var t;let n=null!==(t=({slate:11})[e])&&void 0!==t?t:9;return{lighter:"var(--colors-".concat(e).concat(n-1,")"),base:"var(--colors-".concat(e).concat(n,")"),darker:"var(--colors-".concat(e).concat(n+1,")")}}),i=["brand","slate","blue","yellow","indigo"];(a=s||(s={})).FULL="MMM D, YYYY, hh:mma",a.DATE_ONLY="MMM D, YYYY"},26990:function(e,t,n){"use strict";n.d(t,{R:function(){return d}});var s=n(78653),a=n(28894),r=n(71686),l=n(98124);let i=s.Z.functions.list();async function o(e,t,n){let{projectRef:s,connectionString:a}=e,r=new Headers(n),{result:o}=await (0,l.R)({projectRef:s,connectionString:a,sql:i.sql,queryKey:["database-functions"]},t,r);return o}let d=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(r.A.databaseFunctions(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...l})}},17046:function(e,t,n){"use strict";n.d(t,{u$:function(){return d}});var s=n(28894),a=n(98124),r=n(81508),l=n(71686);let i=e=>{let{schemas:t,limit:n=100}=e;return"\n".concat(r.k,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(t.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(n,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()};async function o(e,t){let{projectRef:n,connectionString:s,schemas:r,limit:l}=e,o=i({schemas:r,limit:l}),{result:d}=await (0,a.R)({projectRef:n,connectionString:s,sql:o,queryKey:["entity-definitions",r]},t);return d[0].data.definitions}let d=function(e){let{projectRef:t,connectionString:n,schemas:a,limit:r}=e,{enabled:i=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(l.A.entityDefinitions(t,a),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n,schemas:a,limit:r},s)},{enabled:i&&void 0!==t&&a.length>0,...d})}},21674:function(e,t,n){"use strict";n.d(t,{Kz:function(){return o}});var s=n(28894),a=n(98124),r=n(71686);let l=e=>{let{table:t,schema:n}=e,s=[];t&&s.push("tablename = '".concat(t,"'")),n&&s.push("schemaname = '".concat(n,"'"));let a=s.length>0?"WHERE ".concat(s.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(a,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()};async function i(e,t){let{projectRef:n,connectionString:s,table:r,schema:i}=e,o=l({table:r,schema:i}),{result:d}=await (0,a.R)({projectRef:n,connectionString:s,sql:o,queryKey:["table-columns",i,r]},t);return d}let o=function(e){let{projectRef:t,connectionString:n,schema:a,table:l}=e,{enabled:o=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.A.tableColumns(t,a,l),e=>{let{signal:s}=e;return i({projectRef:t,connectionString:n,schema:a,table:l},s)},{enabled:o&&void 0!==t,...d})}},84262:function(e,t,n){"use strict";var s=n(97458),a=n(52983),r=n(28977),l=n.n(r),i=n(99272),o=n(35769),d=n(53032),c=n(55386),u=n(20979),m=n(76539),h=n(74058),x=n(30789),f=n(18655),p=n(76323),g=n(52796),y=n(25241);t.Z=e=>{var t,n,r;let{data:v,yAxisKey:j,xAxisKey:b,format:w,customDateFormat:N=f.EE.FULL,title:S,highlightedValue:E,highlightedLabel:_,displayDateInUtc:C,minimalHeader:k,valuePrecision:R,className:L="",size:I="normal",emptyStateMessage:A,onBarClick:D,showLegend:T=!1,xAxisIsDate:z=!0,XAxisProps:M,YAxisProps:Z,showGrid:U=!1}=e,{Container:P}=(0,g.D3)(I),[F,q]=(0,a.useState)(null),O=M||{interval:v.length-2,angle:0,tick:!1},K=Z||{tickFormatter:e=>(0,g.V2)(e,R),tick:!1,width:0},Q=e=>C?l()(e).utc():l()(e),G=function(){if(!z){var e;return F?null===(e=v[F])||void 0===e?void 0:e[b]:_}return null!==F&&v&&void 0!==v[F]&&Q(v[F][b]).format(N)||_}(),W=null!==F?null===(t=v[F])||void 0===t?void 0:t[j]:E;return 0===v.length?(0,s.jsx)(y.Z,{message:A,description:"It may take up to 24 hours for data to refresh",size:I,className:L,attribute:S,format:w}):(0,s.jsxs)("div",{className:["flex flex-col gap-y-3",L].join(" "),"data-sentry-component":"BarChart","data-sentry-source-file":"BarChart.tsx",children:[(0,s.jsx)(p.Z,{title:S,format:w,customDateFormat:N,highlightedValue:"number"==typeof W?(0,g.V2)(W,R):W,highlightedLabel:G,minimalHeader:k,"data-sentry-element":"ChartHeader","data-sentry-source-file":"BarChart.tsx"}),(0,s.jsx)(P,{"data-sentry-element":"Container","data-sentry-source-file":"BarChart.tsx",children:(0,s.jsxs)(i.v,{data:v,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==F&&q(e.activeTooltipIndex)},onMouseLeave:()=>q(null),onClick:e=>{var t,n;let s=null==e?void 0:null===(n=e.activePayload)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.payload;D&&D(s,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"BarChart.tsx",children:[T&&(0,s.jsx)(o.D,{}),U&&(0,s.jsx)(d.q,{stroke:f.ZE.AXIS}),(0,a.createElement)(c.B,{...K,axisLine:{stroke:f.ZE.AXIS},tickLine:{stroke:f.ZE.AXIS},key:j,"data-sentry-element":"YAxis","data-sentry-source-file":"BarChart.tsx"}),(0,a.createElement)(u.K,{...O,axisLine:{stroke:f.ZE.AXIS},tickLine:{stroke:f.ZE.AXIS},key:b,"data-sentry-element":"XAxis","data-sentry-source-file":"BarChart.tsx"}),(0,s.jsx)(m.u,{content:()=>null,"data-sentry-element":"Tooltip","data-sentry-source-file":"BarChart.tsx"}),(0,s.jsx)(h.$,{dataKey:j,fill:f.ZE.GREEN_1,animationDuration:300,maxBarSize:48,"data-sentry-element":"Bar","data-sentry-source-file":"BarChart.tsx",children:null==v?void 0:v.map((e,t)=>(0,s.jsx)(x.b,{className:"transition-all duration-300 ".concat(D?"cursor-pointer":""),fill:F===t||null===F?f.ZE.GREEN_1:f.ZE.GREEN_2,enableBackground:12},"cell-".concat(t)))})]})}),v&&(0,s.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{children:z?Q(v[0][b]).format(N):v[0][b]}),(0,s.jsx)("span",{children:z?Q(null===(n=v[(null==v?void 0:v.length)-1])||void 0===n?void 0:n[b]).format(N):null===(r=v[(null==v?void 0:v.length)-1])||void 0===r?void 0:r[b]})]})]})}},76323:function(e,t,n){"use strict";var s=n(97458);t.Z=e=>{let{format:t,highlightedValue:n,highlightedLabel:a,title:r,minimalHeader:l=!1}=e,i=(0,s.jsx)("h3",{className:"text-foreground-lighter "+(l?"text-xs":"text-sm"),children:r}),o=(0,s.jsxs)("h5",{className:"text-foreground text-xl font-normal ".concat(l?"text-base":"text-2xl"),children:[void 0!==n&&String(n),"seconds"===t?" ":"",(0,s.jsx)("span",{className:"text-lg",children:"function"==typeof t?t(n):t})]}),d=(0,s.jsx)("h5",{className:"text-foreground-lighter text-xs",children:a});return l?(0,s.jsxs)("div",{className:"flex flex-row items-center gap-x-4",style:{minHeight:"1.8rem"},children:[r&&i,(0,s.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==n&&o,d]})]}):(0,s.jsxs)("div",{className:"h-16","data-sentry-component":"ChartHeader","data-sentry-source-file":"ChartHeader.tsx",children:[r&&i,void 0!==n&&o,d]})}},52796:function(e,t,n){"use strict";n.d(t,{Bh:function(){return h},D3:function(){return f},Hx:function(){return x},V2:function(){return u},ww:function(){return p}});var s=n(97458),a=n(28977),r=n.n(a),l=n(13516),i=n.n(l),o=n(52983),d=n(40904),c=n(18655);r().extend(i());let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return m(e)?h(e,t):e.toLocaleString()},m=e=>String(e).includes("."),h=(e,t)=>{if(!m(e))return e.toLocaleString()+"."+"0".repeat(t);{let[n,s]=String(e).split(".");return Number(n).toLocaleString()+"."+s.slice(0,t)}},x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.EE.FULL,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?r().utc(e).format(t):r()(e).format(t)},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},n=t[e];return{Container:(0,o.useMemo)(()=>e=>{let{children:t}=e;return(0,s.jsx)(d.h,{height:n,minHeight:n,width:"100%",children:t})},[e]),minHeight:n}},p=e=>{let{data:t,xAxisKey:n,yAxisKey:s,stackKey:a,variant:r="values"}=e,l=(0,o.useMemo)(()=>t?Object.entries(t.reduce((e,t)=>{let r=t[n],l=t[s],i=t[a];return e[r]||(e[r]={}),e[r][i]=l,e},{})).map(e=>{let[t,s]=e;return{...s,[n]:Number.isNaN(Number(t))?t:Number(t)}}):[],[JSON.stringify(t)]),i=(0,o.useMemo)(()=>Object.keys(l[0]||{}).filter(e=>e!==n&&e!==s).sort(),[JSON.stringify(l[0]||{})]),d=(0,o.useMemo)(()=>{if("percentages"===r)return l.map(e=>{let t=Object.entries(e),n=t.filter(e=>{let[t,n]=e;return i.includes(t)}).reduce((e,t)=>{let[n,s]=t;return e+s},0);return t.reduce((e,t)=>{let[s,a]=t;return i.includes(s)?{...e,[s]:0!==a?a/n:0}:{...e,[s]:a}},{})})},[JSON.stringify(l)]);return{dataKeys:i,stackedData:l,percentagesStackedData:d}}},25241:function(e,t,n){"use strict";var s=n(97458),a=n(9754),r=n(39635),l=n(76323),i=n(52796);t.Z=e=>{let{attribute:t,message:n="No data to show",description:o,format:d,className:c="",size:u}=e,{minHeight:m}=(0,i.D3)(u);return(0,s.jsxs)("div",{"data-sentry-component":"NoDataPlaceholder","data-sentry-source-file":"NoDataPlaceholder.tsx",children:[void 0!==t&&(0,s.jsx)(l.Z,{title:t,format:d,highlightedValue:0}),(0,s.jsxs)("div",{className:(0,r.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",c),style:{minHeight:m+20},children:[(0,s.jsx)(a.Z,{size:20,className:"text-border-stronger","data-sentry-element":"BarChart2","data-sentry-source-file":"NoDataPlaceholder.tsx"}),(0,s.jsxs)("div",{className:"px-1",children:[(0,s.jsx)("p",{className:"text-foreground-light text-xs",children:n}),o&&(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},15824:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tp}});var s=n(97458),a=n(85229),r=n(79367),l=n(52983),i=n(6967),o=n(36457),d=n(59171),c=n(16402),u=n(43901),m=n(94514),h=n(91948),x=n(45328),f=n.n(x),p=n(34549),g=n(85508),y=n(63413),v=n(5334),j=n(64618),b=n(73029),w=n(92787);async function N(e){let{errorMessage:t,sql:n,entityDefinitions:s}=e,a=await (0,b.v_)(w.GW+"/api/ai/sql/debug",{errorMessage:t,sql:n,entityDefinitions:s});if(!(0,b.d8)(a))throw a.error;return a}let S=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,j.D)(e=>N(e),{async onSuccess(t,n,s){await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?p.Am.error("Failed to debug SQL: ".concat(e.message)):t(e,n,s)},...n})};var E=n(96018),_=n(17046),C=n(23346),k=n(32753),R=n(58018),L=n(85101),I=n(48007),A=n(35934),D=n(51303),T=n(15885),z=n(96388),M=n(18624),Z=n(92656),U=n(3448),P=n(78066),F=n(69117),q=n(87335),O=n(57249),K=n(72853),Q=n(12502),G=n(78509),W=n(62880),B=n(59520),V=n(39635),H=n(59158),X=n(99794),Y=n(52176),J=n(68813),$=n(399);let ee=e=>{let{value:t,onChange:n,onSubmit:a,onAccept:r,onReject:i,isDiffVisible:o,isLoading:d=!1}=e;(0,P.fV)();let c=(0,l.useCallback)(e=>{setTimeout(()=>{null==e||e.focus()},0)},[]),u=()=>{t.trim()&&!d&&a(t)};return(0,s.jsxs)("div",{className:"overflow-hidden rounded-md p-0 bg-popover border border-foreground/20 focus-within:border-foreground/30 shadow-xl text-sm max-w-xl","data-sentry-component":"AskAIWidget","data-sentry-source-file":"AskAIWidget.tsx",children:[(0,s.jsx)($.Z,{inputRef:c,size:"xlarge",inputClassName:"bg-transparent border-none shadow-none gap-4 text-xs focus-visible:outline-none focus-visible:ring-0 py-2 pl-3",placeholder:o?"Make an edit...":"Edit SQL via the Assistant...",autoFocus:!0,value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.metaKey||e.ctrlKey||u()},disabled:d,"data-sentry-element":"Input","data-sentry-source-file":"AskAIWidget.tsx"}),o&&(0,s.jsxs)("div",{className:"flex justify-start p-0 border-t",children:[(0,s.jsxs)(Y.z,{type:"text",onClick:r,className:"text-xs h-auto py-1 rounded-none px-3 border-r-border",disabled:d,children:["Accept ",(0,s.jsx)("span",{className:"text-xs text-foreground-light",children:"âŒ˜ + Enter"})]}),(0,s.jsxs)(Y.z,{onClick:i,type:"text",className:"text-xs h-auto py-1 rounded-none px-3 border-r-border",disabled:d,children:["Reject ",(0,s.jsx)("span",{className:"text-xs text-foreground-light",children:"Esc"})]})]})]})};var et=n(16423),en=n(63730),es=e=>{let{children:t,editor:n,id:s,beforeLineNumber:a,afterLineNumber:r=0,heightInLines:i=1}=e,o=null!=a?a:r,d="".concat(s,"-").concat(o.toString()),c=(0,l.useMemo)(()=>document.createElement("div"),[]),u="getModifiedEditor"in n?n.getModifiedEditor():n;return(0,l.useEffect)(()=>{let e;let t=0,n=0,l={getId:()=>s,getDomNode:()=>c,getPosition:()=>null},o=()=>{let e=u.getLayoutInfo();e&&(c.style.left="".concat(e.contentLeft,"px"),c.style.top="".concat(t,"px"),c.style.width="".concat(e.width-e.contentLeft,"px"),c.style.height="".concat(n,"px"))};return u.changeViewZones(s=>{e=s.addZone({afterLineNumber:null!=a?a:r,heightInLines:i,domNode:document.createElement("div"),onDomNodeTop:e=>{t=e,o()},onComputedHeight:e=>{n=e,o()}}),u.addOverlayWidget(l)}),()=>{u.changeViewZones(t=>{t.removeZone(e),u.removeOverlayWidget(l)})}},[u,s,a,r,i,c]),(0,en.createPortal)(t,c,d)},ea=n(96320),er=n(42130);let el=e=>{let{visible:t,hasDestructiveOperations:n,hasUpdateWithoutWhere:a,onCancel:r,onConfirm:l}=e;return(0,s.jsxs)(er.Z,{visible:t,size:"large",title:"Potential issue".concat(n&&a?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:n&&a?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:r,onConfirm:l,"data-sentry-element":"ConfirmationModal","data-sentry-component":"RunQueryWarningModal","data-sentry-source-file":"RunQueryWarningModal.tsx",children:[(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[n&&(0,s.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,s.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,s.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),n&&a&&(0,s.jsx)(ea.Z,{}),a&&(0,s.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,s.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,s.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,s.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,s.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var ei=n(10621),eo=n(19519),ed=n(63277),ec=n(96158),eu=n(24987),em=n(84262),eh=n(25241),ex=n(28977),ef=n.n(ex),ep=n(51829),eg=n(57135),ey=n(92968),ev=n(7945);let ej=(e,t)=>{var n;return(null==e?void 0:null===(n=e.rows)||void 0===n?void 0:n.length)?e.rows.reduce((e,n)=>{let s=e[e.length-1]||{};return[...e,{...n,[t.yKey]:(s[t.yKey]||0)+n[t.yKey]}]},[]):[]},eb=["number","string","date"];function ew(e){let{results:t={rows:[]},config:n,onConfigChange:a}=e,r=(0,l.useMemo)(()=>Object.keys(t.rows[0]||{}).filter(e=>{let n=typeof t.rows[0][e];return eb.includes(n)}),[t]),i=(0,l.useMemo)(()=>ej(t,n),[t,n]),o=n.cumulative?i:t.rows;if(!r.length)return(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(eh.Z,{size:"normal",description:"Execute a query and configure the chart options."})});let d=(e=>{let t=o[0][e];return"number"==typeof t?"number":ef()(t).isValid()?"date":"string"})(n.xKey);return(0,s.jsx)(B.pO,{direction:"horizontal",className:"flex-grow h-full","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"ChartConfig","data-sentry-source-file":"ChartConfig.tsx",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.ee,{className:"p-4 h-full",defaultSize:75,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:"bar"===n.type&&(0,s.jsx)(em.Z,{showLegend:!0,size:"normal",xAxisIsDate:"date"===d,data:o,xAxisKey:n.xKey,yAxisKey:n.yKey,emptyStateMessage:"Execute a query and configure the chart options",showGrid:n.showGrid,XAxisProps:{angle:0,interval:0,hide:!n.showLabels,tickFormatter:e=>{let t=o[+e][n.xKey];return"date"===d?ef()(t).format("MMM D YYYY"):t}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),label:(0,s.jsx)(s.Fragment,{}),hide:!n.showLabels}})}),(0,s.jsx)(B.Dp,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"ChartConfig.tsx"}),(0,s.jsx)(B.ee,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4","data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:(0,s.jsxs)("form",{className:"grid gap-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,s.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),n.xKey&&n.yKey&&(0,s.jsx)(Y.z,{type:"text",onClick:()=>{let e=n.xKey,t=n.yKey;a({...n,xKey:t,yKey:e})},title:"Swap X and Y axis",icon:(0,s.jsx)(ep.Z,{size:"15",className:"text-foreground-lighter"}),children:"Flip"})]}),(0,s.jsxs)(eg.Ph,{value:n.xKey,onValueChange:e=>{a({...n,xKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,s.jsxs)(eg.i4,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:["X Axis ",n.xKey&&"- ".concat(n.xKey)]}),(0,s.jsx)(eg.Bw,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,s.jsx)(eg.DI,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:r.map(e=>(0,s.jsx)(eg.Ql,{value:e,children:e},e))})})]}),(0,s.jsxs)(eg.Ph,{value:n.yKey,onValueChange:e=>{a({...n,yKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,s.jsxs)(eg.i4,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:["Y Axis ",n.yKey&&"- ".concat(n.yKey)]}),(0,s.jsx)(eg.Bw,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,s.jsx)(eg.DI,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:r.map(e=>(0,s.jsx)(eg.Ql,{value:e,children:e},e))})})]}),(0,s.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,s.jsxs)(ey._,{className:"",htmlFor:"cumulative","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,s.jsx)(ev.X,{id:"cumulative",name:"cumulative",checked:n.cumulative,onClick:()=>a({...n,cumulative:!n.cumulative}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Cumulative"]}),(0,s.jsxs)(ey._,{htmlFor:"showLabels","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,s.jsx)(ev.X,{id:"showLabels",name:"showLabels",checked:n.showLabels,onClick:()=>a({...n,showLabels:!n.showLabels}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show labels"]}),(0,s.jsxs)(ey._,{htmlFor:"showGrid","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,s.jsx)(ev.X,{id:"showGrid",name:"showGrid",checked:n.showGrid,onClick:()=>a({...n,showGrid:!n.showGrid}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show grid"]})]})]})})]})})}var eN=n(6494),eS=n.n(eN),eE=n(93702),e_=n.n(eE),eC=n(76705),ek=n.n(eC),eR=n(69107),eL=n.n(eR),eI=n(21935),eA=n(80459),eD=n(61322),eT=n(81307),ez=n(84012),eM=n(20787),eZ=e=>{var t,n,a,r;let{id:i}=e,{project:o}=(0,eM.d2)(),d=(0,W.B0)(),c=null!==(r=null===(n=d.results)||void 0===n?void 0:null===(t=n[i])||void 0===t?void 0:t[0])&&void 0!==r?r:void 0,u=(0,l.useRef)(null),{mutate:m}=(0,D.a)(),h=(0,l.useMemo)(()=>{if(null==c?void 0:c.rows){let e=Array.from(c.rows||[]).map(e=>eL()(e,(e,t)=>ek()(e)?e.replaceAll(/\n/g,"\\n").replaceAll(/"/g,'""'):e_()(e)?JSON.stringify(e).replaceAll(/\"/g,'""'):e));return eS()(e)}return""},[c]),x=(0,l.useMemo)(()=>{if(null==c?void 0:c.rows){let e=Array.from(c.rows||[])[0];if(e)return Object.keys(e)}},[c]);return(0,s.jsxs)(X.h_,{"data-sentry-element":"DropdownMenu","data-sentry-component":"ResultsDropdown","data-sentry-source-file":"ResultsDropdown.tsx",children:[(0,s.jsx)(X.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"ResultsDropdown.tsx",children:(0,s.jsx)(Y.z,{type:"text",iconRight:(0,s.jsx)(eI.Z,{size:14}),"data-sentry-element":"Button","data-sentry-source-file":"ResultsDropdown.tsx",children:"Export"})}),(0,s.jsx)(ez.CSVLink,{ref:u,className:"hidden",headers:x,data:h,filename:"supabase_".concat(null==o?void 0:o.ref,"_").concat(null===(a=d.snippets[i])||void 0===a?void 0:a.snippet.name,".csv"),"data-sentry-element":"CSVLink","data-sentry-source-file":"ResultsDropdown.tsx"}),(0,s.jsxs)(X.AW,{side:"bottom",align:"start","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"ResultsDropdown.tsx",children:[(0,s.jsxs)(X.Xi,{onClick:function(){var e;null===(e=u.current)||void 0===e||e.link.click(),m({action:U.b.SQL_EDITOR_RESULT_DOWNLOAD_CSV_CLICKED})},className:"space-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ResultsDropdown.tsx",children:[(0,s.jsx)(eA.Z,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"ResultsDropdown.tsx"}),(0,s.jsx)("p",{children:"Download CSV"})]}),(0,s.jsxs)(X.Xi,{onClick:function(){if(navigator){if(!c||!c.rows)return"results is empty";if(c.rows.constructor!==Array&&c.error)return c.error;if(0==c.rows.length)return"results is empty";let e=Object.keys(c.rows[0]),t=c.rows.map(t=>{let n=[];return e.forEach(e=>n.push(t[e])),n}),n=[e].concat(t),s=(0,eT.x)(n);(0,P.vQ)(s,()=>{p.Am.success("Copied results to clipboard"),m({action:U.b.SQL_EDITOR_RESULT_COPY_MARKDOWN_CLICKED})})}},className:"space-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ResultsDropdown.tsx",children:[(0,s.jsx)(eD.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"ResultsDropdown.tsx"}),(0,s.jsx)("p",{children:"Copy as markdown"})]}),(0,s.jsxs)(X.Xi,{onClick:function(){if(navigator){if(!c||!c.rows)return"results is empty";if(c.rows.constructor!==Array&&c.error)return c.error;if(0==c.rows.length)return"results is empty";(0,P.vQ)(JSON.stringify(c.rows,null,2),()=>{p.Am.success("Copied results to clipboard"),m({action:U.b.SQL_EDITOR_RESULT_COPY_JSON_CLICKED})})}},className:"space-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"ResultsDropdown.tsx",children:[(0,s.jsx)(eD.Z,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"ResultsDropdown.tsx"}),(0,s.jsx)("p",{children:"Copy as JSON"})]})]})]})},eU=n(87912),eP=n(63489),eF=n(91837),eq=n(41244),eO=n(61506),eK=n(11244),eQ=n(72174),eG=n(55757),eW=n(45125),eB=n(83329),eV=n(20687),eH=n(93284),eX=n(48963),eY=e=>{let{id:t}=e,{profile:n}=(0,F.Un)(),a=(0,W.B0)().snippets[t],r=(null==n?void 0:n.id)===(null==a?void 0:a.snippet.owner_id);return(0,s.jsx)(s.Fragment,{children:r?null:(0,s.jsx)(eX.C,{children:"Read-only"})})},eJ=e=>{let{id:t}=e,{profile:n}=(0,F.Un)(),a=(0,W.B0)(),r=a.savingStates[t],i=(0,eH.D9)(r),[o,d]=(0,l.useState)(!1),c=a.snippets[t],m=(null==n?void 0:n.id)===(null==c?void 0:c.snippet.owner_id);return(0,l.useEffect)(()=>{let e=!1;return"UPDATING"===i&&"IDLE"===r&&(d(!0),setTimeout(()=>{e||d(!1)},5e3)),()=>{e=!0}},[r]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[m&&"UPDATING_FAILED"===r&&(0,s.jsx)(Y.z,{type:"text",size:"tiny",icon:(0,s.jsx)(eB.Z,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>a.addNeedsSaving(t),children:"Retry"}),o?(0,s.jsxs)(H.u,{children:[(0,s.jsx)(H.aJ,{children:(0,s.jsx)(eF.Z,{className:"text-brand",size:14,strokeWidth:3})}),(0,s.jsx)(H._v,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===r?(0,s.jsxs)(H.u,{children:[(0,s.jsx)(H.aJ,{children:(0,s.jsx)(u.Z,{className:"animate-spin",size:14,strokeWidth:2})}),(0,s.jsx)(H._v,{children:"Saving changes..."})]}):"UPDATING_FAILED"===r?m?(0,s.jsxs)(H.u,{children:[(0,s.jsx)(H.aJ,{children:(0,s.jsx)(eV.Z,{className:"text-red-900",size:14,strokeWidth:2})}),(0,s.jsx)(H._v,{children:"Failed to save changes"})]}):(0,s.jsx)(eY,{id:t}):null]})})},e$=e=>{let{id:t,isExecuting:n=!1,isDisabled:a=!1,hasSelection:r,prettifyQuery:l,executeQuery:i}=e,o=(0,P.fV)(),{ref:d}=(0,y.UO)(),c=(0,W.B0)(),[h]=(0,eW.l)(w.dA.SQL_EDITOR_AI_OPEN,!0),[x,f]=(0,eW.l)(w.dA.SQL_EDITOR_INTELLISENSE,!0),[g,v]=(0,eW.l)(w.dA.SQL_EDITOR_LAST_SELECTED_DB(d),""),j=c.snippets[t],b=void 0!==j&&j.snippet.favorite,N=()=>{f(!x),p.Am.success("Successfully ".concat(x?"disabled":"enabled"," intellisense. ").concat(x?"Please refresh your browser for changes to take place.":""))},S=()=>c.addFavorite(t),E=()=>c.removeFavorite(t);return(0,s.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2","data-sentry-component":"UtilityActions","data-sentry-source-file":"UtilityActions.tsx",children:[w.Qy&&(0,s.jsx)(eJ,{id:t}),(0,s.jsxs)(X.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsx)(X.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,s.jsx)(Y.z,{type:"default",className:(0,V.cn)("px-1",h?"block 2xl:hidden":"hidden"),icon:(0,s.jsx)(eU.Z,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,s.jsxs)(X.AW,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsxs)(X.Xi,{className:"justify-between",onClick:N,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eP.Z,{size:14,className:"text-foreground-light","data-sentry-element":"Keyboard","data-sentry-source-file":"UtilityActions.tsx"}),"Intellisense enabled"]}),x&&(0,s.jsx)(eF.Z,{className:"text-brand",size:16})]}),(0,s.jsx)(X.VD,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"UtilityActions.tsx"}),(0,s.jsxs)(X.Xi,{className:"gap-x-2",onClick:()=>{b?E():S()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsx)(eq.Z,{size:14,strokeWidth:2,className:b?"fill-brand stroke-none":"fill-none stroke-foreground-light","data-sentry-element":"Heart","data-sentry-source-file":"UtilityActions.tsx"}),b?"Remove from":"Add to"," favorites"]}),(0,s.jsxs)(X.Xi,{className:"gap-x-2",onClick:l,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsx)(eO.Z,{size:14,strokeWidth:2,className:"text-foreground-light","data-sentry-element":"AlignLeft","data-sentry-source-file":"UtilityActions.tsx"}),"Prettify SQL"]})]})]}),(0,s.jsxs)("div",{className:(0,V.cn)("items-center gap-x-2",h?"hidden 2xl:flex":"flex"),children:[(0,s.jsxs)(X.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsx)(X.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,s.jsx)(Y.z,{type:"text",className:"px-1",icon:(0,s.jsx)(eP.Z,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,s.jsx)(X.AW,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:(0,s.jsxs)(X.Xi,{className:"justify-between",onClick:N,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:["Intellisense enabled",x&&(0,s.jsx)(eF.Z,{className:"text-brand",size:16})]})})]}),w.Qy&&(0,s.jsxs)(H.u,{children:[(0,s.jsx)(H.aJ,{asChild:!0,children:b?(0,s.jsx)(Y.z,{type:"text",size:"tiny",onClick:E,className:"px-1",icon:(0,s.jsx)(eq.Z,{className:"fill-brand stroke-none"})}):(0,s.jsx)(Y.z,{type:"text",size:"tiny",onClick:S,className:"px-1",icon:(0,s.jsx)(eq.Z,{className:"fill-none stroke-foreground-light"})})}),(0,s.jsxs)(H._v,{side:"bottom",children:[b?"Remove from":"Add to"," favorites"]})]}),(0,s.jsxs)(H.u,{"data-sentry-element":"Tooltip_Shadcn_","data-sentry-source-file":"UtilityActions.tsx",children:[(0,s.jsx)(H.aJ,{asChild:!0,"data-sentry-element":"TooltipTrigger_Shadcn_","data-sentry-source-file":"UtilityActions.tsx",children:(0,s.jsx)(Y.z,{type:"text",onClick:l,className:"px-1",icon:(0,s.jsx)(eO.Z,{strokeWidth:2,className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,s.jsx)(H._v,{side:"bottom","data-sentry-element":"TooltipContent_Shadcn_","data-sentry-source-file":"UtilityActions.tsx",children:"Prettify SQL"})]})]}),(0,s.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(eG.Z,{selectedDatabaseId:0===g.length?void 0:g,variant:"connected-on-right",onSelectId:e=>{c.resetResult(t),v(e)},"data-sentry-element":"DatabaseSelector","data-sentry-source-file":"UtilityActions.tsx"}),(0,s.jsx)(eQ.Q,{serviceRoleLabel:"postgres",variant:"connected-on-both","data-sentry-element":"RoleImpersonationPopover","data-sentry-source-file":"UtilityActions.tsx"}),(0,s.jsx)(Y.z,{onClick:()=>i(),disabled:a||n,type:"primary",size:"tiny",iconRight:n?(0,s.jsx)(u.Z,{className:"animate-spin",size:10,strokeWidth:1.5}):(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:["macos"===o?(0,s.jsx)(m.Z,{size:10,strokeWidth:1.5}):(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"CTRL"}),(0,s.jsx)(eK.Z,{size:10,strokeWidth:1.5})]}),className:"rounded-l-none min-w-[82px]","data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx",children:r?"Run selected":"Run"})]})})]})},e0=n(19215),e1=n(29247),e2=n.n(e1),e5=n(78940),e4=n(46037),e8=e=>{var t,n,a,r,l,i,o,d,c;let{id:m,isExecuting:h,isDisabled:x,isDebugging:f,onDebug:p}=e,{ref:g}=(0,y.UO)(),v=(0,Q.TF)(),j=(0,M.l)(),b=(0,W.B0)(),w=null===(t=b.results[m])||void 0===t?void 0:t[0],{data:N}=(0,A.Gl)({orgSlug:null==j?void 0:j.slug}),S=(0,J.$w)(N),E=(null==w?void 0:null===(a=w.error)||void 0===a?void 0:null===(n=a.message)||void 0===n?void 0:n.includes("canceling statement due to statement timeout"))||(null==w?void 0:null===(l=w.error)||void 0===l?void 0:null===(r=l.message)||void 0===r?void 0:r.includes("upstream request timeout"));if(h)return(0,s.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,s.jsx)(u.Z,{size:14,className:"animate-spin"}),(0,s.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==w?void 0:w.error){let e=(null!==(c=null===(o=w.error)||void 0===o?void 0:null===(i=o.formattedError)||void 0===i?void 0:i.split("\n"))&&void 0!==c?c:[]).filter(e=>e.length>0),t=v.selectedDatabaseId!==g&&w.error.message.includes("in a read-only transaction"),n=w.error.message.includes("Query is too large to be run via the SQL Editor");return(0,s.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,s.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[E?(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("p",{className:"font-mono text-sm",children:"SQL query ran into an upstream timeout"}),(0,s.jsxs)("p",{className:"font-mono text-sm text-foreground-light",children:["You can either"," ",(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline transition hover:text-foreground",href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"}),"."]})]}):(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,t)=>(0,s.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(t))):(0,s.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null===(d=w.error)||void 0===d?void 0:d.message]}),w.autoLimit&&(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",w.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),t&&(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),n&&(0,s.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,s.jsxs)(e2(),{target:"_blank",rel:"noreferrer",href:"/project/".concat(g,"/settings/database"),className:"underline transition hover:text-foreground flex items-center gap-x-1",children:["connecting to your database directly",(0,s.jsx)(e0.Z,{size:12})]}),"."]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[t&&(0,s.jsx)(Y.z,{className:"py-2",type:"default",onClick:()=>{v.setSelectedDatabaseId(g),b.resetResult(m)},children:"Switch to primary database"}),!S&&(0,s.jsx)(Y.z,{icon:(0,s.jsx)(e5.c,{className:"scale-75 w-3 h-3",loading:f}),disabled:!!x||f,onClick:p,children:"Debug with Supabase AI"})]})]})})}return w?w.rows.length<=0?(0,s.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,s.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,s.jsx)(e4.Z,{rows:w.rows,"data-sentry-element":"Results","data-sentry-component":"UtilityTabResults","data-sentry-source-file":"UtilityTabResults.tsx"}):(0,s.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:(0,s.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,s.jsx)("code",{children:"Run"})," to execute your query."]})})};let e3={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1};var e6=e=>{var t,n,a;let{id:r,isExecuting:l,isDebugging:i,isDisabled:d,hasSelection:c,prettifyQuery:u,executeQuery:m,onDebug:h}=e,{ref:x}=(0,y.UO)();(0,o.NL)();let f=(0,W.B0)(),g=null===(t=f.snippets[r])||void 0===t?void 0:t.snippet,v=null===(n=f.results[r])||void 0===n?void 0:n[0],{mutate:j}=(0,ec.R)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:t}=e;if("sql"!==t.type||!("chart"in t.content))return;let n={...g,content:{...g.content,chart:t.content.chart}};f.updateSnippet({id:r,snippet:n})},onError:async(e,t,n)=>{p.Am.error("Failed to update chart. Please try again.")}}),b=g&&"sql"===g.type&&(null===(a=g.content)||void 0===a?void 0:a.chart)?g.content.chart:e3;return(0,s.jsxs)(eu.mQ,{defaultValue:"results",className:"w-full h-full flex flex-col","data-sentry-element":"Tabs_Shadcn_","data-sentry-component":"UtilityPanel","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,s.jsxs)(eu.dr,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(eu.SP,{className:"py-3 text-xs",value:"results","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,s.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,s.jsx)(eu.SP,{className:"py-3 text-xs",value:"chart","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,s.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==v?void 0:v.rows)&&(0,s.jsx)(eZ,{id:r})]}),(0,s.jsx)(e$,{id:r,isExecuting:l,isDisabled:d,hasSelection:c,prettifyQuery:u,executeQuery:m,"data-sentry-element":"UtilityActions","data-sentry-source-file":"UtilityPanel.tsx"})]}),(0,s.jsx)(eu.nU,{asChild:!0,value:"results",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,s.jsx)(e8,{id:r,isExecuting:l,isDisabled:d,onDebug:h,isDebugging:i,"data-sentry-element":"UtilityTabResults","data-sentry-source-file":"UtilityPanel.tsx"})}),(0,s.jsx)(eu.nU,{asChild:!0,value:"chart",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,s.jsx)(ew,{results:v,config:b,onConfigChange:function(e){x&&(null==g?void 0:g.id)&&j({projectRef:x,payload:{...g,id:g.id,description:g.description||"",project_id:g.project_id||0,content:{...g.content,content_id:r,chart:e}}})},"data-sentry-element":"ChartConfig","data-sentry-source-file":"UtilityPanel.tsx"})})]})};let e7=f()(()=>n.e(6848).then(n.bind(n,6848)),{loadableGenerated:{webpack:()=>[6848]},ssr:!1}),e9=f()(()=>Promise.resolve().then(n.bind(n,85229)).then(e=>{let{DiffEditor:t}=e;return t}),{loadableGenerated:{webpack:()=>[85229]},ssr:!1}),te=()=>{var e,t,n;let a=(0,P.fV)(),i=(0,r.useRouter)(),{ref:x,id:f}=(0,y.UO)(),{profile:j}=(0,F.Un)(),b=(0,o.NL)(),N=(0,Z.Vm)(),$=(0,M.l)(),en=(0,K.WZ)(),ea=(0,W.B0)(),er=(0,G.z6)(),ec=(0,Q.TF)(),eu=(0,T.C)(),[em]=(0,z.l)(null==N?void 0:N.ref),eh=eu||!w.Qy,{sourceSqlDiff:ex,setSourceSqlDiff:ef,selectedDiffType:ep,setSelectedDiffType:eg,pendingTitle:ey,setIsAcceptDiffLoading:ev,isDiffOpen:ej,defaultSqlDiff:eb,closeDiff:ew}=(0,et.Yx)(),{promptState:eN,setPromptState:eS,promptInput:eE,setPromptInput:e_,resetPrompt:eC}=(0,et.iM)(),ek=(0,l.useRef)(null),eR=(0,l.useRef)(null),eL=(0,l.useRef)(null),[eI,eA]=(0,l.useState)(!1),[eD,eT]=(0,l.useState)([]),[ez,eM]=(0,l.useState)(!1),[eZ,eU]=(0,l.useState)(!1),[eP,eF]=(0,l.useState)(!1),[eq,eO]=(0,l.useState)(!1),[eK,eQ]=(0,l.useState)(!1),eG=(0,l.useMemo)(()=>(0,P.k$)(),[f]),eW=f&&"new"!==f?f:eG,eB=ea.limit,eV=null===(e=ea.results[eW])||void 0===e?void 0:e[0],eH=!(eW in ea.snippets&&void 0!==ea.snippets[eW].snippet.content),eX="new"!==f&&eH,{data:eY}=(0,A.Gl)({orgSlug:null==$?void 0:$.slug}),eJ=(0,J.$w)(eY),{data:e$,isSuccess:e0}=(0,R.bN)({projectRef:x}),{data:e1,refetch:e2}=(0,_.u$)({schemas:em,projectRef:null==N?void 0:N.ref,connectionString:null==N?void 0:N.connectionString},{enabled:eh}),e5=eh?null==e1?void 0:e1.map(e=>e.sql.trim()):void 0,{mutate:e4}=(0,I.X)(),{mutateAsync:e8}=(0,E.g)(),{mutateAsync:e3,isLoading:te}=S(),{mutate:tt}=(0,D.a)(),{mutate:tn,isLoading:ts}=(0,L.r)({onSuccess(e,t){eW&&ea.addResult(eW,e.result,t.autoLimit),e2(),b.invalidateQueries(k.X.lint(x))},onError(e,t){if(eW){if(e.position&&eR.current){var n,s,a;let t=ek.current,r=eR.current,l=eI&&null!==(s=null==t?void 0:null===(n=t.getSelection())||void 0===n?void 0:n.startLineNumber)&&void 0!==s?s:0,i=null!==(a=e.formattedError)&&void 0!==a?a:"",o=i.slice(i.indexOf("LINE")),d=l+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(d)){let e=null==t?void 0:t.deltaDecorations([],[{range:new r.Range(d,1,d,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==t||t.revealLineInCenter(d),eT(e))}}ea.addResultError(eW,e,t.autoLimit)}}}),ta=(0,l.useCallback)(async(e,t)=>{try{let{title:n}=await e8({sql:t});ea.renameSnippet({id:e,name:n})}catch(e){}},[e8,ea]),tr=(0,l.useCallback)(async()=>{if(ej)return;let e=(0,W.pB)().snippets[eW];if(ek.current&&N){var t,n,s,a,r;let l=ek.current,i=l.getSelection(),o=i?null===(t=l.getModel())||void 0===t?void 0:t.getValueInRange(i):void 0,d=e?null!==(r=o||(null===(n=ek.current)||void 0===n?void 0:n.getValue()))&&void 0!==r?r:null===(s=e.snippet.content)||void 0===s?void 0:s.sql:o||(null===(a=ek.current)||void 0===a?void 0:a.getValue());e4({projectRef:N.ref,connectionString:N.connectionString,sql:d},{onSuccess:e=>{var t;let n=null==ek?void 0:null===(t=ek.current)||void 0===t?void 0:t.getModel();ek.current&&n&&(ek.current.executeEdits("apply-prettify-edit",[{text:e.result,range:n.getFullModelRange()}]),ea.setSql(eW,e.result))}})}},[e4,eW,ej,N,ea]),tl=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ej)return;let t=(0,W.pB)().snippets[eW];if(null!==ek.current&&!ts&&void 0!==N){var n,s,a,r,l,i;let o=ek.current,d=o.getSelection(),c=d?null===(n=o.getModel())||void 0===n?void 0:n.getValueInRange(d):void 0,u=t?null!==(i=c||(null===(s=ek.current)||void 0===s?void 0:s.getValue()))&&void 0!==i?i:null===(a=t.snippet.content)||void 0===a?void 0:a.sql:c||(null===(r=ek.current)||void 0===r?void 0:r.getValue()),m=!1,h=(0,ed.mw)(u);!e&&h&&(eU(!0),eF(!0),m=!0);let x=(0,ed.tA)(u);if(!e&&x&&(eU(!0),eO(!0),m=!0),m)return;eJ||(null==t?void 0:t.snippet.name)!==ei.$C||ta(eW,u),eD.length>0&&(null==o||o.deltaDecorations(eD,[]),eT([]));let f=er(),g=null==e$?void 0:null===(l=e$.find(e=>e.identifier===ec.selectedDatabaseId))||void 0===l?void 0:l.connectionString;if(w.Qy&&!g)return p.Am.error("Unable to run query: Connection string is missing");let{appendAutoLimit:y}=(0,ed.c6)(u,eB),v=(0,ed.se)(u,eB);tn({projectRef:N.ref,connectionString:g,sql:(0,q.Jh)(v,{projectRef:N.ref,role:f}),autoLimit:y?eB:void 0,isRoleImpersonationEnabled:(0,G.Gm)(f),contextualInvalidation:!0,handleError:e=>{throw e}})}},[ej,eW,ts,N,eJ,tn,er,ta,ec.selectedDatabaseId,e$,eB]),ti=(0,l.useCallback)(async(e,t)=>{if(!x)return console.error("Project ref is required");if(!j)return console.error("Profile is required");if(!N)return console.error("Project is required");try{let n=(0,ed.wI)({id:(0,P.k$)(),name:t,sql:e,owner_id:j.id,project_id:N.id});ea.addSnippet({projectRef:x,snippet:n}),ea.addNeedsSaving(n.id),i.push("/project/".concat(x,"/sql/").concat(n.id))}catch(e){p.Am.error("Failed to create new query: ".concat(e.message))}},[null==j?void 0:j.id,null==N?void 0:N.id,x,i,ea]),to=(0,l.useCallback)(async()=>{var e,t,n;try{let s=ea.snippets[eW],a=null===(e=ea.results[eW])||void 0===e?void 0:e[0];en.setAiAssistantPanel({open:!0,sqlSnippets:[(null!==(n=null===(t=s.snippet.content)||void 0===t?void 0:t.sql)&&void 0!==n?n:"").replace(ei.eg,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(a.error.message)})}catch(e){e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message&&p.Am.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[e3,e5,eW,ea.results,ea.snippets]),td=(0,l.useCallback)(async()=>{try{if(ev(!0),!ex||!ek.current||!eL.current)return;let e=ek.current.getModel(),t=eL.current.getModel();if(!e||!t)return;let n=t.modified.getValue();if(ep===eo.U.NewSnippet){let{title:e}=await e8({sql:n});await ti(n,e)}else ek.current.executeEdits("apply-ai-edit",[{text:n,range:e.getFullModelRange()}]),ey&&ea.renameSnippet({id:eW,name:ey});tt({action:U.b.ASSISTANT_SQL_DIFF_HANDLER_EVALUATED,properties:{handlerAccepted:!0}}),eg(eo.U.Modification),eC(),ew()}finally{ev(!1)}},[ex,ep,ti,e8,i,eW,ey,ea]),tc=(0,l.useCallback)(()=>{tt({action:U.b.ASSISTANT_SQL_DIFF_HANDLER_EVALUATED,properties:{handlerAccepted:!1}}),eC(),ew()},[ew,eC,tt]),{complete:tu,completion:tm,isLoading:th}=(0,g.GO)({api:"".concat(w.GW,"/api/ai/sql/complete"),body:{projectRef:null==N?void 0:N.ref,connectionString:null==N?void 0:N.connectionString,includeSchemaMetadata:eh},onResponse:e=>{if(!e.ok)throw Error("Failed to generate completion")},onError:e=>{p.Am.error("Failed to generate SQL: ".concat(e.message))}}),tx=async(e,t)=>{try{var n;eS(e=>({...e,selection:t.selection,beforeSelection:t.beforeSelection,afterSelection:t.afterSelection}));let s=await (0,C.oT)();await tu(e,{headers:{Authorization:null!==(n=s.get("Authorization"))&&void 0!==n?n:""},body:{completionMetadata:{textBeforeCursor:t.beforeSelection,textAfterCursor:t.afterSelection,language:"pgsql",prompt:e,selection:t.selection}}})}catch(e){eS(e=>({...e,isLoading:!1}))}};return(0,l.useEffect)(()=>{eW&&(ew(),eS(e=>({...e,isOpen:!1})))},[ew,eW]),(0,l.useEffect)(()=>{let e=e=>{if(ej||eN.isOpen)switch(e.key){case"Enter":("macos"===a?e.metaKey:e.ctrlKey)&&ej&&(td(),eC());return;case"Escape":var t;ej&&tc(),eC(),null===(t=ek.current)||void 0===t||t.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,ej,eN.isOpen,td,tc,eC]),(0,l.useEffect)(()=>{if(ej){let e=eL.current,t=null==e?void 0:e.getModel();if(t&&t.original&&t.modified){t.original.setValue(eb.original),t.modified.setValue(eb.modified);let n=e.getModifiedEditor(),s=eN.startLineNumber;n.revealLineInCenter(s)}}},[ep,ex]),(0,l.useEffect)(()=>{if(e0){let e=e$.find(e=>e.identifier===x);ec.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[e0,e$,x]),(0,l.useEffect)(()=>{if(void 0!==ea.diffContent){var e,t,n,s,a;let{diffType:r,sql:l}=ea.diffContent,i=null===(e=ek.current)||void 0===e?void 0:e.getModel();i&&(0===(null!==(n=null===(t=ek.current)||void 0===t?void 0:t.getValue())&&void 0!==n?n:"").length?null===(s=ek.current)||void 0===s||s.executeEdits("apply-ai-message",[{text:"".concat(l),range:i.getFullModelRange()}]):(ef({original:(null===(a=ek.current)||void 0===a?void 0:a.getValue())||"",modified:l}),eg(r)))}},[ea.diffContent]),(0,l.useEffect)(()=>{if(!tm)return;let e=eN.beforeSelection+eN.selection+eN.afterSelection,t=eN.beforeSelection+tm+eN.afterSelection;if(th){let n=t;try{n=(0,O.WU)(eN.beforeSelection+tm+eN.afterSelection,{language:"postgresql",keywordCase:"lower"})}catch(e){}ef({original:e,modified:n}),eg(eo.U.Modification),eS(e=>({...e,isLoading:!1}))}},[tm,eN.beforeSelection,eN.selection,eN.afterSelection,th]),(0,l.useEffect)(()=>{if(ej){if(eL.current&&ez)return eQ(!0),()=>eQ(!1)}else eM(!1),eQ(!1)},[ej,ez]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(el,{visible:eZ,hasDestructiveOperations:eP,hasUpdateWithoutWhere:eq,onCancel:()=>{eU(!1),eF(!1),eO(!1),setTimeout(()=>{var e;return null===(e=ek.current)||void 0===e?void 0:e.focus()},100)},onConfirm:()=>{eU(!1),tl(!0)},"data-sentry-element":"RunQueryWarningModal","data-sentry-source-file":"SQLEditor.tsx"}),(0,s.jsx)(B.pO,{className:"flex h-full",direction:"horizontal",autoSaveId:w.dA.SQL_EDITOR_AI_PANEL_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:(0,s.jsx)(B.ee,{minSize:30,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,s.jsxs)(B.pO,{className:"relative",direction:"vertical",autoSaveId:w.dA.SQL_EDITOR_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:[(0,s.jsx)(B.ee,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,s.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:eX?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsx)(u.Z,{className:"animate-spin text-brand"})}):(0,s.jsxs)(s.Fragment,{children:[ej&&(0,s.jsxs)("div",{className:"w-full h-full",children:[(0,s.jsx)(e9,{theme:"supabase",language:"pgsql",original:eb.original,modified:eb.modified,onMount:e=>{eL.current=e,eM(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3}}),eK&&(0,s.jsx)(es,{editor:eL.current,id:"ask-ai-diff",heightInLines:3,afterLineNumber:0,beforeLineNumber:Math.max(0,eN.startLineNumber-1),children:(0,s.jsx)(ee,{onSubmit:e=>{tx(e,{beforeSelection:eN.beforeSelection,selection:eN.selection||eb.modified,afterSelection:eN.afterSelection})},value:eE,onChange:e_,onAccept:td,onReject:tc,isDiffVisible:!0,isLoading:th})})]}),(0,s.jsxs)("div",{className:"w-full h-full relative",children:[(0,s.jsx)(e7,{autoFocus:!0,id:eW,className:(0,V.cn)(ej&&"hidden"),editorRef:ek,monacoRef:eR,executeQuery:tl,onHasSelection:eA,onPrompt:e=>{let{selection:t,beforeSelection:n,afterSelection:s,startLineNumber:a,endLineNumber:r}=e;eS(e=>({...e,isOpen:!0,selection:t,beforeSelection:n,afterSelection:s,startLineNumber:a,endLineNumber:r}))}}),ek.current&&eN.isOpen&&!ej&&(0,s.jsx)(es,{editor:ek.current,id:"ask-ai",afterLineNumber:eN.endLineNumber,beforeLineNumber:Math.max(0,eN.startLineNumber-1),heightInLines:2,children:(0,s.jsx)(ee,{value:eE,onChange:e_,onSubmit:e=>{tx(e,{beforeSelection:eN.beforeSelection,selection:eN.selection,afterSelection:eN.afterSelection})},isDiffVisible:!1,isLoading:th})}),(0,s.jsx)(d.M,{children:!eN.isOpen&&!(null===(t=ek.current)||void 0===t?void 0:t.getValue())&&(0,s.jsxs)(c.E.p,{initial:{y:5,opacity:0},animate:{y:0,opacity:1},exit:{y:5,opacity:0},className:"text-foreground-lighter absolute bottom-4 left-4 z-10 font-mono text-xs flex items-center gap-1",children:["Hit ","macos"===a?(0,s.jsx)(m.Z,{size:12}):"CTRL+","K to edit with the Assistant"]})})]},eW)]})})}),(0,s.jsx)(B.Dp,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"SQLEditor.tsx"}),(0,s.jsx)(B.ee,{maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:eX?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsx)(u.Z,{className:"animate-spin text-brand"})}):(0,s.jsx)(e6,{id:eW,isExecuting:ts,isDisabled:ej,isDebugging:te,hasSelection:eI,prettifyQuery:tr,executeQuery:tl,onDebug:to})}),(0,s.jsx)(B.ee,{maxSize:10,minSize:10,className:"max-h-9","data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(null==eV?void 0:eV.rows)!==void 0&&!ts&&(0,s.jsxs)(v.x,{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)(H.u,{children:[(0,s.jsx)(H.aJ,{children:(0,s.jsxs)("p",{className:"text-xs",children:[(0,s.jsxs)("span",{className:"text-foreground",children:[eV.rows.length," row",eV.rows.length>1?"s":""]}),(0,s.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==eV.autoLimit&&" (Limited to only ".concat(eV.autoLimit," rows)")})]})}),(0,s.jsx)(H._v,{className:"max-w-xs",children:(0,s.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,s.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==eV.autoLimit&&(0,s.jsxs)(X.h_,{children:[(0,s.jsx)(X.$F,{asChild:!0,children:(0,s.jsxs)(Y.z,{type:"default",iconRight:(0,s.jsx)(h.Z,{size:14}),children:["Limit results to:"," ",null===(n=ei.Tu.find(e=>e.value===ea.limit))||void 0===n?void 0:n.label]})}),(0,s.jsx)(X.AW,{className:"w-40",align:"end",children:(0,s.jsx)(X._x,{value:ea.limit.toString(),onValueChange:e=>ea.setLimit(Number(e)),children:ei.Tu.map(e=>(0,s.jsx)(X.qB,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})})]})};var tt=n(49650),tn=n(63320);function ts(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function ta(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var tr=n(90671),tl=n(26990),ti=n(28894),to=n(98124),td=n(71686);let tc=()=>"\nSELECT word FROM pg_get_keywords();\n".trim();async function tu(e,t){let{projectRef:n,connectionString:s}=e,a=tc(),{result:r}=await (0,to.R)({projectRef:n,connectionString:s,sql:a,queryKey:["keywords"]},t);return r.map(e=>e.word.toLocaleLowerCase())}let tm=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ti.a)(td.A.keywords(t),e=>{let{signal:s}=e;return tu({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...a})};var th=n(33443),tx=n(21674);let tf=()=>{let e=(0,r.useRouter)(),t=(0,a.useMonaco)(),{id:n,ref:o,content:d,skip:c}=(0,i.U)(),{project:u}=(0,eM.d2)(),m=(0,K.WZ)(),h=(0,W.B0)(),x=(0,W.Fy)(o),{mutateAsync:f}=(0,I.X)(),[p]=(0,eW.l)(w.dA.SQL_EDITOR_INTELLISENSE,!0),{data:g}=(0,tr.N)({projectRef:o,id:n},{retry:!1,enabled:!!("new"!==n&&"function"==typeof h.addSnippet)});async function y(e){try{if(!u)throw Error("No project");return(await f({projectRef:u.ref,connectionString:u.connectionString,sql:e})).result}catch(t){return console.error("formatPgsql error:",t),e}}(0,l.useEffect)(()=>{o&&g&&h.setSnippet(o,g)},[o,g]);let{data:v,isSuccess:j}=tm({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:b,isSuccess:N}=(0,tl.R)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:S,isSuccess:E}=(0,th.Q1)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),{data:_,isSuccess:C}=(0,tx.Kz)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{enabled:p}),k=(0,l.useRef)(null),R=(0,l.useRef)(y);R.current=y;let L=p&&C&&E&&j&&N;return L&&(null===k.current&&(k.current={}),k.current.tableColumns=_,k.current.schemas=S,k.current.keywords=v,k.current.functions=b),(0,l.useEffect)(()=>{"new"===n&&"true"!==c&&void 0!==m.dashboardHistory.sql&&void 0===d&&void 0!==x.find(e=>e.id===m.dashboardHistory.sql)&&e.push("/project/".concat(o,"/sql/").concat(m.dashboardHistory.sql))},[n,x,d]),(0,l.useEffect)(()=>{if(t){let e=t.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(e){let t=e.getValue(),s=await R.current(t);return n&&h.setSql(n,s),[{range:e.getFullModelRange(),text:s}]}});return()=>e.dispose()}},[t]),(0,l.useEffect)(()=>{if(L){let e,n;return t&&L&&(e=t.languages.registerCompletionItemProvider("pgsql",{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(e,n,s){try{let a=new tn.Z(e,n.column-2,n.lineNumber-1);if('"'===s.triggerCharacter)return function(e,t,n){let s=[];if(!n.isFowardDQuote())return{suggestions:s};if(n.next(),n.isNextPeriod()){let a=n.readIdent(),r=!1;a.match(/^\".*?\"$/)&&(r=!0,a=ts(a));let l=t.current.tableColumns.find(e=>r&&e.tablename===a||!r&&e.tablename.toLocaleLowerCase()==a.toLocaleLowerCase());if(!l)return{suggestions:s};l.columns.forEach(t=>{s.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:t.attname})})}else t.current.tableColumns.forEach(t=>{s.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,insertText:t.tablename})});return{suggestions:s}}(t,k,a);if("."===s.triggerCharacter)return function(e,t,n){let s=[],a=n.readIdents(3).map(e=>{let t=!1;return e.match(/^\".*?\"$/)&&(t=!0,e=ts(e)),{isQuoted:t,name:e}}),r=0,l=t.current.schemas.find(e=>{var t,n;let s=a&&a.length>r?a[r]:{};return s.isQuoted&&e.name===s.name||!s.isQuoted&&(null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=s.name)||void 0===n?void 0:n.toLocaleLowerCase())});if(l?r++:l=t.current.schemas.find(e=>"public"==e.name),a.length==r)return t.current.tableColumns.forEach(t=>{t.schemaname==l.name&&s.push({label:t.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==t.schemaname?t.schemaname:null,insertText:ta(t.tablename)})}),{suggestions:s};let i=t.current.tableColumns.find(e=>{var t,n;let s=a&&a.length>r?a[r]:{};return e.schemaname==l.name&&s.isQuoted&&e.tablename===s.name||!s.isQuoted&&(null===(t=e.tablename)||void 0===t?void 0:t.toLocaleLowerCase())==(null===(n=s.name)||void 0===n?void 0:n.toLocaleLowerCase())});return i&&i.columns.forEach(t=>{s.push({label:t.attname,kind:e.languages.CompletionItemKind.Property,detail:t.data_type,insertText:ta(t.attname)})}),{suggestions:s}}(t,k,a);return function(e,t){var n,s,a,r;let l=[];return(null===(n=t.current.keywords)||void 0===n?void 0:n.length)>0&&t.current.keywords.forEach(t=>{l.push({label:t,kind:e.languages.CompletionItemKind.Keyword,insertText:t})}),(null===(s=t.current.schemas)||void 0===s?void 0:s.length)>0&&t.current.schemas.forEach(t=>{l.push({label:t.name,kind:e.languages.CompletionItemKind.Keyword,insertText:t.name})}),(null===(a=t.current.tableColumns)||void 0===a?void 0:a.length)>0&&t.current.tableColumns.forEach(t=>{let n="public"==t.schemaname?t.tablename:t.schemaname+"."+t.tablename;l.push({label:t.tablename,detail:"public"!==t.schemaname?t.schemaname:null,kind:t.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:ta(n)}),t.columns.forEach(n=>{if(!n)return;let s=l.find(t=>t.label===(null==n?void 0:n.attname)&&t.kind===e.languages.CompletionItemKind.Field&&t.detail===(null==n?void 0:n.data_type));s?(s.tables.push(t.tablename),s.tables.sort(),s.documentation=s.tables.join(", ")):l.push({label:n.attname,kind:e.languages.CompletionItemKind.Field,detail:n.data_type,documentation:t.tablename,tables:[t.tablename],insertText:ta(n.attname)})})}),(null===(r=t.current.functions)||void 0===r?void 0:r.length)>0&&t.current.functions.forEach(t=>{l.push({label:t.name,kind:e.languages.CompletionItemKind.Function,detail:t.return_type,insertText:t.name})}),{suggestions:l}}(t,k)}catch(e){return{suggestions:[]}}}}),n=t.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,t){let n=new tn.Z(e,t.column-2,t.lineNumber-1),s=n.readArguments();if(s<0)return null;let a=n.readIdent();if(!a||a.match(/^\".*?\"$/))return null;let r=k.current.functions.find(e=>e.name.toLocaleLowerCase()===a.toLocaleLowerCase());if(!r||!r.args||r.args.length<s)return null;let l=Math.min(s,r.args.length-1),i=[];return i.push({label:"".concat(r.name,"(").concat(r.argument_types,")"),parameters:r.args.map(e=>({label:e.name}))}),{value:{signatures:i,activeSignature:0,activeParameter:l},dispose:()=>{}}}})),()=>{null==e||e.dispose(),null==n||n.dispose()}}},[L]),(0,s.jsx)("div",{className:"flex-1 overflow-auto","data-sentry-component":"SqlEditor","data-sentry-source-file":"[id].tsx",children:(0,s.jsx)(te,{"data-sentry-element":"SQLEditor","data-sentry-source-file":"[id].tsx"})})};tf.getLayout=e=>(0,s.jsx)(tt.Z,{title:"SQL",children:e});var tp=tf},74313:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var s=n(97458),a=n(52983),r=n(59158);let l=(0,a.forwardRef)((e,t)=>(0,s.jsx)("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",...e,children:(0,s.jsx)("path",{d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",fillRule:"evenodd",clipRule:"evenodd"})})),i=(0,a.forwardRef)((e,t)=>{let{...n}=e;return(0,s.jsxs)(r.u,{children:[(0,s.jsx)(r.aJ,{type:"button",role:"button",className:"flex [&_svg]:data-[state=delayed-open]:fill-foreground-lighter [&_svg]:data-[state=instant-open]:fill-foreground-lighter",children:(0,s.jsx)(l,{strokeWidth:2,className:"transition-colors fill-foreground-muted w-4 h-4"})}),(0,s.jsx)(r._v,{...n})]})})},86812:function(e,t,n){"use strict";n.d(t,{r:function(){return c}});var s=n(97458),a=n(56384),r=n(80086),l=n(52983),i=n(39635);let o=(0,r.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),d=(0,r.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),c=l.forwardRef((e,t)=>{let{className:n,size:r,...l}=e;return(0,s.jsx)(a.fC,{className:(0,i.cn)(o({size:r}),n),...l,ref:t,children:(0,s.jsx)(a.bU,{className:(0,i.cn)(d({size:r}))})})});c.displayName=a.fC.displayName}},function(e){e.O(0,[4176,588,5154,656,8703,698,8682,8375,4439,69,8790,659,5741,3439,5313,6437,5206,5538,5518,2930,7249,747,8685,1859,7686,3182,1515,9386,9210,3200,6623,9167,9650,9774,2888,179],function(){return e(e.s=58288)}),_N_E=e.O()}]);