!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="35f1de77-5ce5-4fdf-93cc-b2173edacc81",e._sentryDebugIdIdentifier="sentry-dbid-35f1de77-5ce5-4fdf-93cc-b2173edacc81")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7704],{29787:function(e,t,s){var n=s(41351),a=s(87493),r=s(79312),o=s(55589),l=s(30568),i=s(85778),c=s(32840),d=s(50922),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(l(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||i(e)||d(e)||r(e)))return!e.length;var t=a(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!n(e).length;for(var s in e)if(u.call(e,s))return!1;return!0}},65192:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/auth/hooks",function(){return s(24212)}])},31992:function(e,t,s){"use strict";s.d(t,{QI:function(){return o},cK:function(){return r}});var n=s(29787),a=s.n(n);function r(e){let t=null==e?void 0:e.split(",").map(e=>e.trim());return a()(e)||!t||0===t.length?{value:[]}:{value:t.map(e=>{let t=e.match(/(\w+)\s+([\w\[\]]+)(?:\s+DEFAULT\s+(.*))?/i);if(!t)return console.error("Error while trying to parse function arguments",e),null;{let[,e,s,n]=t,a=n?n.trim():void 0;return["timestamp","time","timetz","timestamptz"].includes(s.toLowerCase())&&a&&(a="'".concat(a,"'")),{name:e,type:s,defaultValue:a}}}).filter(Boolean)}}function o(e){let t=[];if(e)for(var s in e)t.push({name:s,value:e[s]});return{value:t}}},35407:function(e,t,s){"use strict";s.d(t,{Q:function(){return l}});var n=s(97458),a=s(25019),r=s(48963),o=s(38095),l=e=>{let{page:t,menu:s}=e;return(0,n.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto","data-sentry-component":"ProductMenu","data-sentry-source-file":"ProductMenu.tsx",children:(0,n.jsx)(a.ZP,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"ProductMenu.tsx",children:s.map((e,l)=>(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"my-6 space-y-8",children:(0,n.jsxs)("div",{className:"mx-3",children:[(0,n.jsx)(a.ZP.Group,{title:e.title?(0,n.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,n.jsx)("span",{children:e.title}),e.isPreview&&(0,n.jsx)(r.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,n.jsx)("div",{children:e.items.map(e=>(0,n.jsx)(o.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),l!==s.length-1&&(0,n.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},91592:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(96725).Z)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]])},61885:function(e,t,s){"use strict";s.d(t,{Z:function(){return g}});var n=s(97458),a=s(63413),r=s(79367),o=s(85467),l=s(35407),i=s(23096),c=s(88551),d=s(29247),u=s.n(d),h=s(65832),m=s(52176),p=s(9386),f=s(92787);let x=e=>[{title:"Manage",items:[{name:"Users",key:"users",url:"/project/".concat(e,"/auth/users"),items:[]}]},{title:"Configuration",items:[{name:"Policies",key:"policies",url:"/project/".concat(e,"/auth/policies"),items:[]},...f.Qy?[{name:"Providers",key:"providers",url:"/project/".concat(e,"/auth/providers"),items:[]},{name:"Rate Limits",key:"rate-limits",url:"/project/".concat(e,"/auth/rate-limits"),items:[]},{name:"Email Templates",key:"templates",url:"/project/".concat(e,"/auth/templates"),items:[]},{name:"URL Configuration",key:"url-configuration",url:"/project/".concat(e,"/auth/url-configuration"),items:[]},{name:"Hooks",key:"hooks",url:"/project/".concat(e,"/auth/hooks"),items:[],label:"BETA"}]:[]]}],y=()=>{let{ref:e="default"}=(0,a.UO)(),t=(0,o.ar)();(0,i.kM)({projectRef:e});let s=(0,r.useRouter)().pathname.split("/")[4];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Q,{page:s,menu:x(e),"data-sentry-element":"ProductMenu","data-sentry-source-file":"AuthLayout.tsx"}),t&&(0,n.jsx)("div",{className:"px-3",children:(0,n.jsxs)(h.bZ,{children:[(0,n.jsx)(h.Cd,{className:"text-sm",children:"Column Privileges has been shifted"}),(0,n.jsxs)(h.X,{className:"text-xs",children:[(0,n.jsx)("p",{className:"mb-2",children:"It can now be found in the menu under the database section."}),(0,n.jsx)(m.z,{asChild:!0,type:"default",size:"tiny",children:(0,n.jsx)(u(),{href:"/project/".concat(e,"/database/column-privileges"),children:"Head over to Database"})})]})]})})]})};var g=(0,c.Q)(e=>{let{title:t,children:s}=e;return(0,n.jsx)(p.Z,{title:t||"Authentication",product:"Authentication",productMenu:(0,n.jsx)(y,{}),isBlocking:!1,"data-sentry-element":"ProjectLayout","data-sentry-component":"AuthLayout","data-sentry-source-file":"AuthLayout.tsx",children:s})})},80865:function(e,t,s){"use strict";s.d(t,{p:function(){return o}});var n=s(97458),a=s(39635),r=s(55771);let o=e=>{let{title:t,description:s,docsUrl:o,actions:l,className:i}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("mb-6 flex items-center justify-between gap-x-4 ".concat(i)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),s&&(0,n.jsx)("div",{className:"prose text-sm max-w-full",children:s})]}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==o&&(0,n.jsx)(r.G,{href:o}),l]})]})}},55742:function(e,t,s){"use strict";s.d(t,{l:function(){return r}});var n=s(97458),a=s(39635);function r(e){return(0,n.jsxs)("div",{className:(0,a.cn)("mx-auto max-w-4xl px-5 pt-12 pb-20",e.className),"data-sentry-component":"FormsContainer","data-sentry-source-file":"FormsContainer.tsx",children:[e.header&&(0,n.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,n.jsx)("div",{className:"space-y-20",children:e.children})]})}},14802:function(e,t,s){"use strict";var n=s(97458),a=s(20687);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,r=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.Z,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(r,{})})}):(0,n.jsx)(r,{})}},38095:function(e,t,s){"use strict";var n=s(97458),a=s(29247),r=s.n(a),o=s(25019),l=s(48963),i=s(52176);t.Z=e=>{let{name:t="",isActive:s,isExternal:a,icon:c,rightIcon:d,url:u="",target:h="_self",onClick:m,textClassName:p="",hoverText:f="",label:x}=e,y=(0,n.jsx)(o.ZP.Item,{icon:c,rounded:!0,active:s,onClick:m,children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,n.jsxs)("div",{title:f||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+p,children:[(0,n.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==x&&(0,n.jsx)(l.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:x})]}),d&&(0,n.jsx)("div",{children:d})]})});return u?a?(0,n.jsx)(i.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,n.jsx)(r(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,n.jsx)(r(),{href:u,className:"block",target:h,children:y}):y}},24212:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eh}});var n=s(97458),a=s(198),r=s(52983),o=s(34549),l=s(63413),i=s(20787),c=s(95767),d=s(77554),u=s(80865),h=s(23096),m=s(36457),p=s(64618),f=s(23346),x=s(389);async function y(e){let{projectRef:t,config:s}=e,{data:n,error:a}=await (0,f.r$)("/platform/auth/{ref}/config/hooks",{params:{path:{ref:t}},body:s});return a&&(0,f.S3)(a),n}let g=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,m.NL)();return(0,p.D)(e=>y(e),{async onSuccess(t,s,a){let{projectRef:r}=s;await n.invalidateQueries(x.o.authConfig(r)),await (null==e?void 0:e(t,s,a))},async onError(e,s,n){void 0===t?o.Am.error("Failed to update auth hooks: ".concat(e.message)):t(e,s,n)},...s})};var j=s(98124),v=s(39635),b=s(42130),N=s(21935),k=s(79387),w=s(35934),S=s(40809),_=s(18624),C=s(92787),T=s(99794),E=s(52176);let A=[{title:"Send SMS hook",subtitle:"Will be called by Supabase Auth each time an SMS message needs to be sent.",enabledKey:"HOOK_SEND_SMS_ENABLED",uriKey:"HOOK_SEND_SMS_URI",secretsKey:"HOOK_SEND_SMS_SECRETS",enterprise:!1},{title:"Send Email hook",subtitle:"Will be called by Supabase Auth each time an email message needs to be sent.",enabledKey:"HOOK_SEND_EMAIL_ENABLED",uriKey:"HOOK_SEND_EMAIL_URI",secretsKey:"HOOK_SEND_EMAIL_SECRETS",enterprise:!1},{title:"Customize Access Token (JWT) Claims hook",subtitle:"Will be called by Supabase Auth each time a new JWT is created. It should return the claims you wish to be present in the JWT.",enabledKey:"HOOK_CUSTOM_ACCESS_TOKEN_ENABLED",uriKey:"HOOK_CUSTOM_ACCESS_TOKEN_URI",secretsKey:"HOOK_CUSTOM_ACCESS_TOKEN_SECRETS",enterprise:!1},{title:"MFA Verification Attempt hook",subtitle:"Will be called by Supabase Auth each time a user tries to verify an MFA factor. Return a decision on whether to reject the attempt and future ones, or to allow the user to keep trying.",enabledKey:"HOOK_MFA_VERIFICATION_ATTEMPT_ENABLED",uriKey:"HOOK_MFA_VERIFICATION_ATTEMPT_URI",secretsKey:"HOOK_MFA_VERIFICATION_ATTEMPT_SECRETS",enterprise:!0},{title:"Password Verification Attempt hook",subtitle:"Will be called by Supabase Auth each time a user tries to sign in with a password. Return a decision whether to allow the user to reject the attempt, or to allow the user to keep trying.",enabledKey:"HOOK_PASSWORD_VERIFICATION_ATTEMPT_ENABLED",uriKey:"HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI",secretsKey:"HOOK_PASSWORD_VERIFICATION_ATTEMPT_SECRETS",enterprise:!0}],O=(e,t)=>{if(e.startsWith("https"))return{type:"https",url:e,secret:t||""};{let[t,s,n,a,r]=(e||"").split("/");return{type:"postgres",schema:a||"",functionName:r||""}}},H=e=>"postgres"===e.method.type&&e.method.schema.length>0&&e.method.functionName.length>0||"https"===e.method.type&&e.method.url.startsWith("https")&&e.method.secret.length>0,K=(e,t)=>["-- Revoke access to function from supabase_auth_admin\nrevoke execute on function ".concat(e,".").concat(t," from supabase_auth_admin;"),"-- Revoke access to schema from supabase_auth_admin\nrevoke usage on schema ".concat(e," from supabase_auth_admin;"),"-- Restore function permissions to authenticated, anon and public\ngrant execute on function ".concat(e,".").concat(t," to authenticated, anon, public;")],M=e=>{var t;let{buttonText:s="Add hook",onSelectHook:r}=e,{ref:o}=(0,l.UO)(),i=(0,_.l)(),{data:c}=(0,w.Gl)({orgSlug:null==i?void 0:i.slug},{enabled:C.Qy}),{data:d}=(0,h.$E)({projectRef:o}),u=(0,S.Xo)(a.KA.AUTH_EXECUTE,"*"),m=A.map(e=>({...e,enabled:(null==d?void 0:d[e.enabledKey])||!1,method:O((null==d?void 0:d[e.uriKey])||"",(null==d?void 0:d[e.secretsKey])||"")})),p=m.filter(e=>!H(e)&&!e.enterprise),f=m.filter(e=>!H(e)&&e.enterprise),x=(null==c?void 0:c.plan.id)==="team"||(null==c?void 0:c.plan.id)==="enterprise";return u?(0,n.jsxs)(T.h_,{modal:!1,"data-sentry-element":"DropdownMenu","data-sentry-component":"AddHookDropdown","data-sentry-source-file":"AddHookDropdown.tsx",children:[(0,n.jsx)(T.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"AddHookDropdown.tsx",children:(0,n.jsx)(E.z,{type:"primary",iconRight:(0,n.jsx)(N.Z,{className:"w-4 h-4",strokeWidth:1}),"data-sentry-element":"Button","data-sentry-source-file":"AddHookDropdown.tsx",children:s})}),(0,n.jsxs)(T.AW,{className:"w-76",align:"end","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"AddHookDropdown.tsx",children:[(0,n.jsx)("div",{children:p.map(e=>(0,n.jsx)(T.Xi,{onClick:()=>r(e.title),children:e.title},e.title))}),(0,n.jsx)(T.VD,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"AddHookDropdown.tsx"}),!x&&(0,n.jsxs)(T.Ju,{className:"grid gap-1 bg-surface-200",children:[(0,n.jsx)("p",{className:"text-foreground-light",children:"Team or Enterprise Plan required"}),(0,n.jsxs)("p",{className:"text-foreground-lighter text-xs",children:["The following hooks are not available on"," ",(0,n.jsx)("a",{target:"_href",href:"https://supabase.com/dashboard/org/".concat(null!==(t=null==i?void 0:i.slug)&&void 0!==t?t:"_","/billing"),className:"underline",children:"your plan"}),"."]})]}),f.map(e=>x?(0,n.jsx)(T.Xi,{disabled:!x,className:"",onClick:()=>r(e.title),children:e.title},e.title):(0,n.jsx)(T.Xi,{disabled:!x,onClick:()=>r(e.title),children:e.title},e.title))]})]}):(0,n.jsx)(k.u,{disabled:!0,type:"primary",tooltip:{content:{side:"bottom",text:"You need additional permissions to add auth hooks"}},children:s})};var I=s(78751),V=s(94849),P=s(98773),R=s.n(P),D=s(86848),L=s(87831),Z=s(5394),F=s(31992),U=s(61593),W=s(47137),z=s(35995),B=s(96320),X=s(75135),q=s(86812),Q=s(9189),G=s(93475),J=s(98874);let Y="create-edit-auth-hook",$=Z.Ry({hookType:Z.Z_(),enabled:Z.O7(),selectedType:Z.G0([Z.i0("https"),Z.i0("postgres")]),httpsValues:Z.Ry({url:Z.Z_(),secret:Z.Z_()}),postgresValues:Z.Ry({schema:Z.Z_(),functionName:Z.Z_()})}).superRefine((e,t)=>("https"!==e.selectedType||(e.httpsValues.url.startsWith("https://")||t.addIssue({path:["httpsValues","url"],code:Z.NL.custom,message:"The URL must start with https://"}),e.httpsValues.secret||t.addIssue({path:["httpsValues","secret"],code:Z.NL.custom,message:"Missing secret value"})),"postgres"!==e.selectedType||(e.postgresValues.schema||t.addIssue({path:["postgresValues","schema"],code:Z.NL.custom,message:"You must select a schema"}),e.postgresValues.functionName||t.addIssue({path:["postgresValues","functionName"],code:Z.NL.custom,message:"You must select a Postgres function"})),!0)),ee=e=>{let{visible:t,title:s,authConfig:a,onClose:c,onDelete:u}=e,{ref:h}=(0,l.UO)(),{project:m}=(0,i.d2)(),p=(0,r.useMemo)(()=>A.find(e=>e.title===s)||A[0],[s]),f="HOOK_SEND_EMAIL_ENABLED"===p.enabledKey?["json","jsonb","void"]:["json","jsonb"],x=(0,r.useMemo)(()=>({...p,enabled:(null==a?void 0:a[p.enabledKey])||!1,method:O((null==a?void 0:a[p.uriKey])||"",(null==a?void 0:a[p.secretsKey])||"")}),[p,a]),y=!H(x),b=(0,D.cI)({resolver:(0,I.F)($),defaultValues:{hookType:s||"",enabled:!0,selectedType:"postgres",httpsValues:{url:"",secret:""},postgresValues:{schema:"public",functionName:""}}}),N=b.watch(),k=(0,r.useMemo)(()=>{let e=[];return"postgres"===x.method.type&&""!==x.method.schema&&""!==x.method.functionName&&x.method.functionName!==N.postgresValues.functionName&&(e=K(x.method.schema,x.method.functionName)),""!==N.postgresValues.functionName&&(e=[...e,"-- Grant access to function to supabase_auth_admin\ngrant execute on function ".concat(N.postgresValues.schema,".").concat(N.postgresValues.functionName," to supabase_auth_admin;"),"-- Grant access to schema to supabase_auth_admin\ngrant usage on schema ".concat(N.postgresValues.schema," to supabase_auth_admin;"),"-- Revoke function permissions from authenticated, anon and public\nrevoke execute on function ".concat(N.postgresValues.schema,".").concat(N.postgresValues.functionName," from authenticated, anon, public;")]),e},[x,N.postgresValues.schema,N.postgresValues.functionName]),{mutate:w,isLoading:S}=g({onSuccess:()=>{o.Am.success("Successfully created ".concat(N.hookType,".")),k.length>0&&(0,j.R)({projectRef:h,connectionString:m.connectionString,sql:k.join("\n")}),c()},onError:e=>{o.Am.error("Failed to create hook: ".concat(e.message))}}),_=async e=>{if(!m)return console.error("Project is required");let t=A.find(t=>e.hookType===t.title);if(!t)return;let s=t.enabledKey,n=t.uriKey,a=t.secretsKey,r="";r="postgres"===e.selectedType?"pg-functions://postgres/".concat(e.postgresValues.schema,"/").concat(e.postgresValues.functionName):e.httpsValues.url,w({projectRef:h,config:{[s]:e.enabled,[n]:r,[a]:"https"===e.selectedType?e.httpsValues.secret:null}})};return(0,r.useEffect)(()=>{if(t){if(p){let e=O((null==a?void 0:a[p.uriKey])||"",(null==a?void 0:a[p.secretsKey])||"");b.reset({hookType:p.title,enabled:(null==a?void 0:a[p.enabledKey])||!1,selectedType:e.type,httpsValues:{url:"https"===e.type&&e.url||"",secret:"https"===e.type&&e.secret||""},postgresValues:{schema:"postgres"===e.type&&e.schema||"public",functionName:"postgres"===e.type&&e.functionName||""}})}else b.reset({hookType:s||"",enabled:!0,selectedType:"postgres",httpsValues:{url:"",secret:""},postgresValues:{schema:"public",functionName:""}})}},[a,s,t,p]),(0,n.jsx)(z.yo,{open:t,onOpenChange:()=>c(),"data-sentry-element":"Sheet","data-sentry-component":"CreateHookSheet","data-sentry-source-file":"CreateHookSheet.tsx",children:(0,n.jsxs)(z.ue,{size:"lg",showClose:!1,className:"flex flex-col gap-0","data-sentry-element":"SheetContent","data-sentry-source-file":"CreateHookSheet.tsx",children:[(0,n.jsx)(z.Tu,{className:"py-3 flex flex-row justify-between items-center border-b-0","data-sentry-element":"SheetHeader","data-sentry-source-file":"CreateHookSheet.tsx",children:(0,n.jsxs)("div",{className:"flex flex-row gap-3 items-center",children:[(0,n.jsxs)(z.sw,{className:(0,v.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),"data-sentry-element":"SheetClose","data-sentry-source-file":"CreateHookSheet.tsx",children:[(0,n.jsx)(V.Z,{className:"h-3 w-3","data-sentry-element":"X","data-sentry-source-file":"CreateHookSheet.tsx"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,n.jsx)(z.bC,{className:"truncate","data-sentry-element":"SheetTitle","data-sentry-source-file":"CreateHookSheet.tsx",children:y?"Add ".concat(s):"Update ".concat(s)})]})}),(0,n.jsx)(B.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"CreateHookSheet.tsx"}),(0,n.jsx)(z.DN,{className:"overflow-auto flex-grow px-0","data-sentry-element":"SheetSection","data-sentry-source-file":"CreateHookSheet.tsx",children:(0,n.jsx)(X.l0,{...b,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateHookSheet.tsx",children:(0,n.jsxs)("form",{id:Y,className:"space-y-6 w-full py-5 flex-1",onSubmit:b.handleSubmit(_),children:[(0,n.jsx)(X.Wi,{name:"enabled",control:b.control,render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{layout:"flex",className:"px-5",label:"Enable ".concat(N.hookType),description:"Send SMS hook"===N.hookType?"SMS Provider settings will be disabled in favor of SMS hooks":void 0,children:(0,n.jsx)(X.NI,{children:(0,n.jsx)(q.r,{checked:t.value,onCheckedChange:t.onChange,disabled:t.disabled})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateHookSheet.tsx"},"enabled"),(0,n.jsx)(B.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"CreateHookSheet.tsx"}),(0,n.jsx)(X.Wi,{control:b.control,name:"selectedType",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{label:"Hook type",className:"px-5",children:(0,n.jsx)(X.NI,{children:(0,n.jsxs)(Q.W,{value:t.value,onValueChange:e=>t.onChange(e),children:[(0,n.jsx)(Q.j,{value:"postgres",id:"postgres",label:"Postgres",description:"Used to call a Postgres function."},"postgres"),(0,n.jsx)(Q.j,{value:"https",id:"https",label:"HTTPS",description:"Used to call any HTTPS endpoint."},"https")]})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateHookSheet.tsx"}),"postgres"===N.selectedType?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-8 px-5",children:[(0,n.jsx)(X.Wi,{control:b.control,name:"postgresValues.schema",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{label:"Postgres Schema",description:"Postgres schema where the function is defined",children:(0,n.jsx)(X.NI,{children:(0,n.jsx)(W.Z,{size:"small",showError:!1,selectedSchemaName:t.value,onSelectSchema:e=>t.onChange(e),disabled:t.disabled})})})}},"postgresValues.schema"),(0,n.jsx)(X.Wi,{control:b.control,name:"postgresValues.functionName",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{label:"Postgres function",description:"This function will be called by Supabase Auth each time the hook is triggered",children:(0,n.jsx)(X.NI,{children:(0,n.jsx)(U.Z,{size:"small",schema:N.postgresValues.schema,value:t.value,onChange:t.onChange,disabled:t.disabled,filterFunction:e=>{if(f.includes(e.return_type)){let{value:t}=(0,F.cK)(e.argument_types);return 1===t.length&&("json"===t[0].type||"jsonb"===t[0].type)}return!1},noResultsLabel:(0,n.jsxs)("span",{children:["No function with a single JSON/B argument",(0,n.jsx)("br",{}),"and JSON/B","HOOK_SEND_EMAIL_ENABLED"===p.enabledKey?" or void":""," ","return type found in this schema."]})})})})}},"postgresValues.functionName")]}),(0,n.jsxs)("div",{className:"h-72 w-full gap-3 flex flex-col",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light px-5",children:"The following statements will be executed on the selected function:"}),(0,n.jsx)(d.Z,{id:"postgres-hook-editor",isReadOnly:!0,language:"pgsql",value:k.join("\n\n")})]})]}):(0,n.jsxs)("div",{className:"flex flex-col gap-4 px-5",children:[(0,n.jsx)(X.Wi,{control:b.control,name:"httpsValues.url",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{label:"URL",description:"Supabase Auth will send a HTTPS POST request to this URL each time the hook is triggered.",children:(0,n.jsx)(X.NI,{children:(0,n.jsx)(G.I,{...t})})})}},"httpsValues.url"),(0,n.jsx)(X.Wi,{control:b.control,name:"httpsValues.secret",render:e=>{let{field:t}=e;return(0,n.jsx)(J.E,{label:"Secret",description:(0,n.jsx)(L.D,{children:"It should be a base64 encoded hook secret with a prefix `v1,whsec_`. `v1` denotes the signature version, and `whsec_` signifies a symmetric secret."}),children:(0,n.jsx)(X.NI,{children:(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsx)(G.I,{...t,className:"rounded-r-none border-r-0"}),(0,n.jsx)(E.z,{type:"default",size:"small",className:"rounded-l-none",onClick:()=>{let e=function(){let e=R()(60).toString("base64");return"v1,whsec_".concat(e)}();b.setValue("httpsValues.secret",e)},children:"Generate secret"})]})})})}},"httpsValues.secret")]})]})})}),(0,n.jsxs)(z.FF,{"data-sentry-element":"SheetFooter","data-sentry-source-file":"CreateHookSheet.tsx",children:[!y&&(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(E.z,{type:"danger",onClick:()=>u(),children:"Delete hook"})}),(0,n.jsx)(E.z,{disabled:S,type:"default",onClick:()=>c(),"data-sentry-element":"Button","data-sentry-source-file":"CreateHookSheet.tsx",children:"Cancel"}),(0,n.jsx)(E.z,{form:Y,htmlType:"submit",disabled:S,loading:S,"data-sentry-element":"Button","data-sentry-source-file":"CreateHookSheet.tsx",children:y?"Create hook":"Update hook"})]})]})})};var et=s(91592),es=s(91837),en=s(399),ea=s(48963),er=s(78066);let eo=e=>{let{hook:t,onSelect:s}=e,r=(0,S.Xo)(a.KA.AUTH_EXECUTE,"*");return(0,n.jsxs)("div",{className:"bg-surface-100 border-default overflow-hidden border shadow px-5 py-4 flex flex-row first:rounded-t-md last:rounded-b-md space-x-4","data-sentry-component":"HookCard","data-sentry-source-file":"HookCard.tsx",children:[(0,n.jsx)("div",{className:"",children:(0,n.jsx)(et.Z,{size:21,strokeWidth:"1","data-sentry-element":"Webhook","data-sentry-source-file":"HookCard.tsx"})}),(0,n.jsxs)("div",{className:"flex flex-col flex-0 overflow-y-auto w-full",children:[(0,n.jsx)("span",{className:"text-sm text-foreground",children:t.title}),(0,n.jsx)("span",{className:"text-sm text-foreground-lighter",children:t.subtitle}),(0,n.jsx)("div",{className:"text-sm flex flex-row space-x-5 py-4",children:"postgres"===t.method.type?(0,n.jsxs)("div",{className:"flex flex-col w-full space-y-2",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"type"}),(0,n.jsx)("span",{className:"text-foreground",children:"Postgres function"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"schema"}),(0,n.jsx)(en.Z,{title:t.method.schema,copy:!0,readOnly:!0,disabled:!0,className:"input-mono [&>div>div>div>input]:text-xs [&>div>div>div>input]:opacity-100 flex-1",value:t.method.schema,onCopy:()=>"postgres"===t.method.type&&(0,er.vQ)(t.method.schema)})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"function"}),(0,n.jsx)(en.Z,{title:t.method.functionName,copy:!0,readOnly:!0,disabled:!0,className:"input-mono [&>div>div>div>input]:text-xs [&>div>div>div>input]:opacity-100 flex-1",value:t.method.functionName,onCopy:()=>"postgres"===t.method.type&&(0,er.vQ)(t.method.functionName)})]})]}):(0,n.jsxs)("div",{className:"flex flex-col w-full space-y-2",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"type"}),(0,n.jsx)("span",{className:"text-foreground",children:"HTTPS endpoint"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"endpoint"}),(0,n.jsx)(en.Z,{title:t.method.url,copy:!0,readOnly:!0,disabled:!0,className:"input-mono [&>div>div>div>input]:text-xs [&>div>div>div>input]:opacity-100 flex-1",value:t.method.url,onCopy:()=>"https"===t.method.type&&(0,er.vQ)(t.method.url)})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[(0,n.jsx)("span",{className:"text-foreground-light w-20",children:"secret"}),(0,n.jsx)(en.Z,{copy:!0,title:t.method.secret,reveal:!0,readOnly:!0,disabled:!0,className:"input-mono [&>div>div>div>input]:text-xs [&>div>div>div>input]:opacity-100 flex-1",value:t.method.secret})]})]})}),(0,n.jsx)("div",{className:"flex flex-row gap-2",children:(0,n.jsx)(k.u,{type:"default",disabled:!r,onClick:()=>s(),tooltip:{content:{side:"bottom",text:r?void 0:"You need additional permissions to configure auth hooks"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"HookCard.tsx",children:"Configure hook"})})]}),(0,n.jsx)("div",{className:"flex-1",children:t.enabled?(0,n.jsxs)(ea.C,{className:"space-x-1",variant:"brand",children:[(0,n.jsx)("div",{className:"h-3.5 w-3.5 bg-brand rounded-full flex justify-center items-center",children:(0,n.jsx)(es.Z,{className:"h-2 w-2 text-background-overlay ",strokeWidth:6})}),(0,n.jsx)("span",{children:"Enabled"})]}):(0,n.jsx)(ea.C,{variant:"warning",children:(0,n.jsx)("span",{children:"Disabled"})})})]})},el=()=>{let{ref:e}=(0,l.UO)(),{project:t}=(0,i.d2)(),{data:s,error:a,isError:m}=(0,h.$E)({projectRef:e}),[p,f]=(0,r.useState)(null),[x,y]=(0,r.useState)(null),{mutate:N,isLoading:k}=g({onSuccess:async()=>{if(!x)return;let{method:s}=x;if("postgres"===s.type){let n=K(s.schema,s.functionName);await (0,j.R)({projectRef:e,connectionString:t.connectionString,sql:n.join("\n")})}o.Am.success("".concat(x.title," has been deleted.")),y(null),f(null)},onError:e=>{o.Am.error("Failed to delete hook: ".concat(e.message))}}),w=A.map(e=>({...e,enabled:(null==s?void 0:s[e.enabledKey])||!1,method:O((null==s?void 0:s[e.uriKey])||"",(null==s?void 0:s[e.secretsKey])||"")}));return m?(0,n.jsx)(c.Z,{error:a,subject:"Failed to retrieve auth configuration for hooks"}):(0,n.jsxs)("div",{className:"pb-4","data-sentry-component":"HooksListing","data-sentry-source-file":"HooksListing.tsx",children:[(0,n.jsx)(u.p,{title:"Auth Hooks",description:"Use Postgres functions or HTTP endpoints to customize the behavior of Supabase Auth to meet your needs.",actions:(0,n.jsx)(M,{onSelectHook:f}),"data-sentry-element":"FormHeader","data-sentry-source-file":"HooksListing.tsx"}),0===w.filter(e=>H(e)).length&&(0,n.jsxs)("div",{className:"border rounded border-default px-20 py-16 flex flex-col items-center justify-center space-y-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"No hooks configured yet"}),(0,n.jsx)(M,{buttonText:"Add a new hook",onSelectHook:f})]}),(0,n.jsx)("div",{className:"-space-y-px",children:w.filter(e=>H(e)).map(e=>(0,n.jsx)(eo,{hook:e,onSelect:()=>f(e.title)},e.enabledKey))}),(0,n.jsx)(ee,{title:p,visible:!!p,onDelete:()=>{let e=w.find(e=>e.title===p);e&&y(e)},onClose:()=>f(null),authConfig:s,"data-sentry-element":"CreateHookSheet","data-sentry-source-file":"HooksListing.tsx"}),(0,n.jsx)(b.Z,{visible:!!x,size:"large",variant:"destructive",loading:k,title:"Confirm to delete ".concat(null==x?void 0:x.title),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>y(null),onConfirm:()=>{x&&N({projectRef:e,config:{[x.enabledKey]:!1,[x.uriKey]:null,[x.secretsKey]:null}})},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"HooksListing.tsx",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete the ",null==x?void 0:x.title,"?"]}),(null==x?void 0:x.method.type)==="postgres"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["The following statements will be executed on the"," ",null==x?void 0:x.method.schema,".",null==x?void 0:x.method.functionName," function:"]}),(0,n.jsx)("div",{className:(0,v.cn)("mt-4","h-72"),children:(0,n.jsx)(d.Z,{id:"deletion-hook-editor",isReadOnly:!0,language:"pgsql",value:K(null==x?void 0:x.method.schema,null==x?void 0:x.method.functionName).join("\n\n")})})]})]})})]})};var ei=s(61885),ec=s(55742),ed=s(14802);let eu=()=>{let e=(0,S.Xo)(a.KA.READ,"custom_config_gotrue");return(0,S.N4)()&&!e?(0,n.jsx)(ed.Z,{isFullPage:!0,resourceText:"access your project's auth hooks"}):(0,n.jsx)(ec.l,{children:(0,n.jsx)(el,{})})};eu.getLayout=e=>(0,n.jsx)(ei.Z,{children:e});var eh=eu},25019:function(e,t,s){"use strict";s.d(t,{ZP:function(){return h}});var n=s(97458),a=s(52983),r=s(86815),o=s(39635);function l(e){let{children:t,className:s,tag:a="div",style:r}=e;return(0,n.jsx)("".concat(a),{style:r,"data-sentry-element":"CustomTag","data-sentry-component":"Typography","data-sentry-source-file":"Typography.tsx",children:t})}l.Title=function(e){let{className:t,level:s=1,children:a,style:r}=e;return(0,n.jsx)("h".concat(s),{style:r,"data-sentry-element":"CustomTag","data-sentry-component":"Title","data-sentry-source-file":"Title.tsx",children:a})},l.Text=function(e){let{className:t,children:s,style:a,type:r,disabled:o,mark:l,code:i,keyboard:c,underline:d,strikethrough:u,strong:h,small:m}=e;return i?(0,n.jsx)("code",{style:a,children:s}):l?(0,n.jsx)("mark",{style:a,children:s}):c?(0,n.jsx)("kbd",{style:a,children:s}):h?(0,n.jsx)("strong",{style:a,children:s}):(0,n.jsx)("span",{style:a,"data-sentry-component":"Text","data-sentry-source-file":"Text.tsx",children:s})},l.Link=function(e){let{children:t,target:s="_blank",href:a,className:r,onClick:o,style:l}=e;return(0,n.jsx)("a",{onClick:o,href:a,target:s,rel:"noopener noreferrer",style:l,"data-sentry-component":"Link","data-sentry-source-file":"Link.tsx",children:t})};let i=(0,a.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,n.jsx)(i.Provider,{value:{type:t},"data-sentry-element":"unknown","data-sentry-component":"MenuContextProvider","data-sentry-source-file":"MenuContext.tsx",children:e.children})},d=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:s,ulClassName:a,style:r,type:o="text"}=e;return(0,n.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:s,style:r,"data-sentry-component":"Menu","data-sentry-source-file":"Menu.tsx",children:(0,n.jsx)(c,{type:o,"data-sentry-element":"MenuContextProvider","data-sentry-source-file":"Menu.tsx",children:(0,n.jsx)("ul",{className:a,children:t})})})}u.Item=function(e){let{children:t,icon:s,active:a,rounded:l,onClick:i,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:h}=e,m=(0,r.Z)("menu"),{type:p}=d(),f=[m.item.base];f.push(m.item.variants[p].base),a?f.push(m.item.variants[p].active):f.push(m.item.variants[p].normal);let x=[m.item.content.base];a?x.push(m.item.content.active):x.push(m.item.content.normal);let y=[m.item.icon.base];return a?y.push(m.item.icon.active):y.push(m.item.icon.normal),(0,n.jsxs)("li",{role:"menuitem",className:(0,o.cn)("outline-none",f),style:h,onClick:i,"aria-current":a?"page":void 0,"data-sentry-component":"Item","data-sentry-source-file":"Menu.tsx",children:[s&&(0,n.jsx)("div",{className:"".concat(y.join(" ")," min-w-fit"),children:s}),(0,n.jsx)("span",{className:x.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:s,title:a}=e,o=(0,r.Z)("menu"),{type:l}=d();return(0,n.jsxs)("div",{className:[o.group.base,o.group.variants[l]].join(" "),"data-sentry-component":"Group","data-sentry-source-file":"Menu.tsx",children:[s&&(0,n.jsx)("span",{className:o.group.icon,children:s}),(0,n.jsx)("span",{className:o.group.content,children:a}),t]})},u.Misc=function(e){let{children:t}=e;return(0,n.jsx)("div",{"data-sentry-component":"Misc","data-sentry-source-file":"Menu.tsx",children:(0,n.jsx)(l.Text,{"data-sentry-element":"unknown","data-sentry-source-file":"Menu.tsx",children:(0,n.jsx)("span",{children:t})})})};var h=u},98773:function(e,t,s){"use strict";var n=s(12840),a=s(21607).Buffer,r=s.g.crypto||s.g.msCrypto;r&&r.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw RangeError("requested too many random bytes");var s=a.allocUnsafe(e);if(e>0){if(e>65536)for(var o=0;o<e;o+=65536)r.getRandomValues(s.slice(o,o+65536));else r.getRandomValues(s)}return"function"==typeof t?n.nextTick(function(){t(null,s)}):s}:e.exports=function(){throw Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},21607:function(e,t,s){var n=s(15313),a=n.Buffer;function r(e,t){for(var s in e)t[s]=e[s]}function o(e,t,s){return a(e,t,s)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(r(n,t),t.Buffer=o),o.prototype=Object.create(a.prototype),r(a,o),o.from=function(e,t,s){if("number"==typeof e)throw TypeError("Argument must not be a number");return a(e,t,s)},o.alloc=function(e,t,s){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof s?n.fill(t,s):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}}},function(e){e.O(0,[4176,588,5154,656,8703,698,8682,8375,4439,69,8790,659,5741,3439,5313,6437,2495,8685,1859,7686,3182,1515,9386,5719,9774,2888,179],function(){return e(e.s=65192)}),_N_E=e.O()}]);